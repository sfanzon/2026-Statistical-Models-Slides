<!DOCTYPE html>
<html lang="en"><head>
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/foldbox/foldbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="Dr.&nbsp;Silvio Fanzon">
  <title>Statistical Models</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
  .Corollary {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Axiom {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .TODO {
    --color1: #e7b1b4;
    --color2: #8c3236;
  }
  .Important {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .DONE {
    --color1: #cce7b1;
    --color2: #86b754;
  }
  .Theorem {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Idea {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Proposition {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Lemma {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Warning {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Proof {
    --color1: #f1f1f2;
    --color2: #c0c0c1;
  }
  .Problem {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Question {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  .Notation {
    --color1: #c6e6ed;
    --color2: #1995ad;
  }
  .Remark {
    --color1: #bce5de;
    --color2: #21aa93;
  }
  .Definition {
    --color1: #c6e6ed;
    --color2: #1995ad;
  }
  .Example {
    --color1: #bce5de;
    --color2: #21aa93;
  }
  .Conjecture {
    --color1: #f4cce0;
    --color2: #db4d92;
  }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Statistical Models</h1>
  <p class="subtitle">Lecture 11</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://www.silviofanzon.com">Dr.&nbsp;Silvio Fanzon</a> 
</div>
<div class="quarto-title-author-email">
<a href="mailto:S.Fanzon@hull.ac.uk">S.Fanzon@hull.ac.uk</a>
</div>
        <p class="quarto-title-affiliation">
            University of Hull
          </p>
    </div>
</div>

</section>
<section>
<section id="lecture-11-stepwise-regression-anova" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Lecture 11: <br>Stepwise Regression &amp; <br> ANOVA</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="outline-of-lecture-11" class="slide level2">
<h2>Outline of Lecture 11</h2>
<ol type="1">
<li>Multicollinearity</li>
<li>Stepwise regression</li>
<li>Stepwise regression and overfitting</li>
<li>One-way ANOVA</li>
<li>Factors in R</li>
<li>Anova with aov</li>
<li>Dummy variable regression models</li>
<li>ANOVA as Regression</li>
<li>ANCOVA</li>
</ol>
</section></section>
<section>
<section id="part-1-multicollinearity" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 1: <br>Multicollinearity</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="multicollinearity" class="slide level2 smaller">
<h2>Multicollinearity</h2>
<ul>
<li>The general linear regression model is</li>
</ul>
<p><span class="math display">
Y_i = \beta_1 z_{i1} + \beta_2 z_{i2} + \ldots + \beta_p z_{ip} + \varepsilon_i
</span></p>
<ul>
<li>Consider Assumption 6
<ul>
<li>The design matrix <span class="math inline">Z</span> is such that <span class="math display">
  Z^T Z  \, \text{ is invertible}
  </span></li>
</ul></li>
<li><strong>Multicollinearity:</strong> The violation of Assumption 6</li>
</ul>
<p><span class="math display">
\det(Z^T Z ) \, \approx  \, 0  \, \quad \implies \quad Z^T Z \, \text{ is (almost) not invertible}
</span></p>
</section>
<section id="causes-of-multicollinearity" class="slide level2 smaller">
<h2>Causes of Multicollinearity</h2>
<p><span class="math display">
\text{Multicollinearity = multiple (linear) relationships between the Z-variables}
</span></p>
<ul>
<li>Multicollinearity arises when there is either
<ul>
<li><strong>exact</strong> linear relationship amongst the <span class="math inline">Z</span>-variables</li>
<li><strong>approximate</strong> linear relationship amongst the <span class="math inline">Z</span>-variables</li>
</ul></li>
</ul>
<p><br></p>
<p><strong><span class="math inline">Z</span>-variables <em>inter-related</em></strong> <span class="math inline">\quad \implies \quad</span> <strong>hard to isolate individual influence on <span class="math inline">Y</span></strong></p>
</section>
<section id="example-of-multicollinear-data" class="slide level2 smaller">
<h2>Example of Multicollinear data</h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<div style="font-size: 0.95em">
<ul>
<li>Exact collinearity for <span class="math inline">Z_1</span> and <span class="math inline">Z_2</span>
<ul>
<li>because of exact linear relation <span class="math display">
  Z_2 = 5 Z_1
  </span></li>
</ul></li>
<li>Approximate collinearity for <span class="math inline">Z_1</span> and <span class="math inline">Z_3</span>
<ul>
<li>because <span class="math inline">Z_3</span> is small perturbation of <span class="math inline">Z_2</span> <span class="math display">
  Z_3 \approx Z_2
  </span></li>
</ul></li>
</ul>
</div>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="example-of-multicollinear-data-1" class="slide level2 smaller">
<h2>Example of Multicollinear data</h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<div style="font-size: 0.92em">
<ul>
<li><p>Approximate collinearity for <span class="math inline">Z_3</span> and <span class="math inline">Z_1</span> <span class="math display">
  Z_3 \approx 5 Z_1
  </span></p></li>
<li><p><strong>All instances qualify as multicollinearity</strong></p></li>
</ul>
</div>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="example-of-multicollinear-data-2" class="slide level2 smaller">
<h2>Example of Multicollinear data</h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<div style="font-size: 0.92em">
<ul>
<li>Since these relations are present, correlation is high</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter the data</span></span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">24</span>, <span class="dv">30</span>)</span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a>Z2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>)</span>
<span id="cb1-4"><a aria-hidden="true" tabindex="-1"></a>Z3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">75</span>, <span class="dv">97</span>, <span class="dv">129</span>, <span class="dv">152</span>)</span>
<span id="cb1-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Z1 and Z3 are approx correlated</span></span>
<span id="cb1-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(Z1, Z3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9958817</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Z1 and Z2 are exactly correlated</span></span>
<span id="cb3-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(Z1, Z2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Z2 and Z3 are approx correlated</span></span>
<span id="cb5-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(Z2, Z3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9958817</code></pre>
</div>
</div>
</div>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="consequences-of-multicollinearity" class="slide level2 smaller">
<h2>Consequences of Multicollinearity</h2>
<div style="font-size: 0.95em">
<ul>
<li>Therefore, multicollinearity means that
<ul>
<li>Predictors <span class="math inline">Z_j</span> are (approximately) linearly dependent</li>
<li>E.g. one can be written as (approximate) linear combination of the others</li>
</ul></li>
<li>Recall that the design matrix is</li>
</ul>
<p><span class="math display">
Z
= (Z_1 | Z_2 | \ldots | Z_p) =
\left(
\begin{array}{cccc}
z_{11}  &amp; z_{12} &amp; \ldots &amp; z_{1p} \\
z_{21}  &amp; z_{22} &amp; \ldots &amp; z_{2p} \\
\ldots  &amp; \ldots &amp; \ldots &amp; \ldots \\
z_{n1}  &amp; z_{n2} &amp; \ldots &amp; z_{np} \\
\end{array}
\right)
</span></p>
<ul>
<li><span class="math inline">Z</span> has <span class="math inline">p</span> columns. If at least one pair <span class="math inline">Z_i</span> and <span class="math inline">Z_j</span> is collinear (linearly dependent), then</li>
</ul>
<p><span class="math display">
{\rm rank} (Z) &lt; p
</span></p>
</div>
</section>
<section id="section" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.95em">
<ul>
<li>Basic linear algebra tells us that</li>
</ul>
<p><span class="math display">
{\rm rank} \left(  Z^T Z  \right) = {\rm rank} \left(  Z  \right)
</span></p>
<ul>
<li>Therefore, if we have collinearity</li>
</ul>
<p><span class="math display">
{\rm rank} \left(  Z^T Z  \right) &lt; p
\qquad \implies \qquad
Z^T Z \,\, \text{ is NOT invertible}
</span></p>
<ul>
<li>In this case the least-squares estimator is not well defined</li>
</ul>
<p><span class="math display">
\hat{\beta} = (Z^T Z)^{-1} Z^T y
</span></p>
<p><strong>Multicollinearity is a big problem!</strong></p>
</div>
</section>
<section id="example-of-non-invertible-zt-z" class="slide level2 smaller">
<h2>Example of non-invertible <span class="math inline">Z^T Z</span></h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<ul>
<li><p><span class="math inline">Z_1, Z_2, Z_3</span> as before</p></li>
<li><p>Exact Multicollinearity since <span class="math display">
Z_2 = 5 Z_1
</span></p></li>
<li><p>Thus <span class="math inline">Z^T Z</span> is not invertible</p></li>
<li><p>Let us check with R</p></li>
</ul>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="example-of-non-invertible-zt-z-1" class="slide level2 smaller">
<h2>Example of non-invertible <span class="math inline">Z^T Z</span></h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter the data</span></span>
<span id="cb7-2"><a aria-hidden="true" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">24</span>, <span class="dv">30</span>)</span>
<span id="cb7-3"><a aria-hidden="true" tabindex="-1"></a>Z2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>)</span>
<span id="cb7-4"><a aria-hidden="true" tabindex="-1"></a>Z3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">75</span>, <span class="dv">97</span>, <span class="dv">129</span>, <span class="dv">152</span>)</span>
<span id="cb7-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Assemble design matrix</span></span>
<span id="cb7-7"><a aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(Z1, Z2, Z3), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb7-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute determinant of Z^T Z</span></span>
<span id="cb7-10"><a aria-hidden="true" tabindex="-1"></a><span class="fu">det</span> ( <span class="fu">t</span>(Z) <span class="sc">%*%</span> Z )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3.531172e-07</code></pre>
</div>
</div>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="section-1" class="slide level2 smaller">
<h2></h2>
<ul>
<li><p>R computed that <span class="math inline">\,\, {\rm det} ( Z^T Z) = -3.531172 \times 10^{-7}</span></p></li>
<li><p>Therefore the determinant of <span class="math inline">Z^T Z</span> is almost <span class="math inline">0</span></p></li>
</ul>
<p><span class="math display">
Z^T Z \text{ is not invertible!}
</span></p>
<ul>
<li>If we try to invert <span class="math inline">Z^T Z</span> in R we get an error</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute inverse of Z^T Z</span></span>
<span id="cb9-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span> ( <span class="fu">t</span>(Z) <span class="sc">%*%</span> Z )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="verbatim"><code>
Error in solve.default(t(Z) %*% Z) : 
  system is computationally singular: reciprocal condition number = 8.25801e-19
</code></pre>
</section>
<section id="approximate-multicollinearity" class="slide level2 smaller">
<h2>Approximate Multicollinearity</h2>
<ul>
<li><p>In practice, one almost never has exact Multicollinearity</p></li>
<li><p>If Multicollinearity is present, it is likely to be <strong>Approximate Multicollinearity</strong></p></li>
<li><p>In case of approximate Multicollinearity, it holds that</p>
<ul>
<li>The matrix <span class="math inline">Z^T Z</span> can be inverted</li>
<li>The estimator <span class="math inline">\hat \beta</span> can be computed <span class="math display">
  \hat \beta = (Z^T Z)^{-1} Z^T y
  </span></li>
<li>However the inversion is <strong>numerically instable</strong></li>
</ul></li>
<li><p>Approximate Multicollinearity is still a big problem!</p>
<ul>
<li><strong>Due to numerical instability, we may not be able to trust the estimator <span class="math inline">\hat \beta</span></strong></li>
</ul></li>
</ul>
</section>
<section id="effects-of-numerical-instability-on-t-tests" class="slide level2 smaller">
<h2>Effects of numerical instability on t-tests</h2>
<ul>
<li>Approximate Multicollinearity implies that
<ul>
<li><span class="math inline">Z^T Z</span> is invertible</li>
<li>The inversion is numerically instable</li>
</ul></li>
<li>Numerically instable inversion means that</li>
</ul>
<p><span class="math display">
\text{Small perturbations in } Z  \quad \implies \quad \text{large variations in } (Z^T Z)^{-1}
</span></p>
<ul>
<li>Denote by <span class="math inline">\xi_{ij}</span> the entries of <span class="math inline">(Z^T Z)^{-1}</span></li>
</ul>
<p><span class="math display">
\text{Small perturbations in } Z  \quad \implies \quad \text{large variations in } \xi_{ij}
</span></p>
<ul>
<li>In particular, this might lead to larger than usual values <span class="math inline">\xi_{ij}</span></li>
</ul>
</section>
<section id="section-2" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Recall formula of estimated standard error for <span class="math inline">\beta_j</span></li>
</ul>
<p><span class="math display">
\mathop{\mathrm{e.s.e.}}(\beta_j) = \xi_{jj}^{1/2} \, S   \,, \qquad \quad S^2 = \frac{\mathop{\mathrm{RSS}}}{n-p}
</span></p>
<ul>
<li>The numbers <span class="math inline">\xi_{jj}</span> are the diagonal entries of <span class="math inline">(Z^T Z)^{-1}</span></li>
</ul>
<p><span class="math display">\begin{align*}
\text{Multicollinearity} &amp; \quad \implies \quad \text{Numerical instability} \\[5pts]
&amp; \quad \implies \quad \text{potentially larger } \xi_{jj} \\[5pts]
&amp; \quad \implies \quad \text{potentially larger } \mathop{\mathrm{e.s.e.}}(\beta_j)
\end{align*}</span></p>
</section>
<section id="section-3" class="slide level2 smaller">
<h2></h2>
<ul>
<li>To test the null hypothesis that <span class="math inline">\beta_j = 0</span>, we use <span class="math inline">t</span>-statistic</li>
</ul>
<p><span class="math display">
t = \frac{\beta_j}{ \mathop{\mathrm{e.s.e.}}(\beta_j) }
</span></p>
<ul>
<li><p>But Multicollinearity increases the <span class="math inline">\mathop{\mathrm{e.s.e.}}(\beta_j)</span></p></li>
<li><p>Therefore, the t-statistic reduces in size:</p>
<ul>
<li>t-statistic will be smaller than it should</li>
<li>The p-values will be large <span class="math inline">p &gt; 0.05</span></li>
</ul></li>
</ul>
<p><strong>Multicollinearity <span class="math inline">\implies</span> It becomes harder to reject incorrect hypotheses!</strong></p>
</section>
<section id="example-of-numerical-instability" class="slide level2 smaller">
<h2>Example of numerical instability</h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<ul>
<li><p><span class="math inline">Z_1, Z_2, Z_3</span> as before</p></li>
<li><p>We know we have exact Multicollinearity, since <span class="math display">
Z_2 = 5 Z_1
</span></p></li>
<li><p>Therefore <span class="math inline">Z^T Z</span> is not invertible</p></li>
</ul>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="example-of-numerical-instability-1" class="slide level2 smaller">
<h2>Example of numerical instability</h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<ul>
<li><p>To get rid of Multicollinearity we can add a small perturbation to <span class="math inline">Z_1</span> <span class="math display">
Z_1 \,\, \leadsto \,\, Z_1 + 0.01
</span></p></li>
<li><p>The new dataset <span class="math inline">Z_1 + 0.01, Z_2, Z_3</span> is</p>
<ul>
<li>Not anymore exactly Multicollinear</li>
<li>Still approximately Multicollinear</li>
</ul></li>
</ul>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="example-of-numerical-instability-2" class="slide level2 smaller">
<h2>Example of numerical instability</h2>
<div class="columns" style="display: flex !important; height: 90%;">
<div class="column" style="display: flex; justify-content: center; align-items: center;">
<ul>
<li><p>Define the new design matrix <span class="math display">
Z = (Z_1 + 0.01 | Z_2 | Z_3)
</span></p></li>
<li><p>Data is approximately Multicollinear</p></li>
<li><p>Therefore the inverse of <span class="math inline">Z^T Z</span> exists</p></li>
<li><p>Let us compute this inverse in R</p></li>
</ul>
</div><div class="column" style="display: flex; justify-content: center; align-items: center;">
<table class="caption-top">
<thead>
<tr class="header">
<th><span class="math inline">Z_1 + 0.01</span></th>
<th><span class="math inline">Z_2</span></th>
<th><span class="math inline">Z_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10.01</td>
<td>50</td>
<td>52</td>
</tr>
<tr class="even">
<td>15.01</td>
<td>75</td>
<td>75</td>
</tr>
<tr class="odd">
<td>18.01</td>
<td>90</td>
<td>97</td>
</tr>
<tr class="even">
<td>24.01</td>
<td>120</td>
<td>129</td>
</tr>
<tr class="odd">
<td>30.01</td>
<td>150</td>
<td>152</td>
</tr>
</tbody>
</table>
</div></div>
</section>
<section id="section-4" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.92em">
<ul>
<li>Let us compute the inverse of</li>
</ul>
<p><span class="math display">
Z = (Z_1 + 0.01 | Z_2 | Z_3)
</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Consider perturbation Z1 + 0.01</span></span>
<span id="cb11-2"><a aria-hidden="true" tabindex="-1"></a>PZ1 <span class="ot">&lt;-</span> Z1 <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb11-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Assemble perturbed design matrix</span></span>
<span id="cb11-5"><a aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(PZ1, Z2, Z3), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb11-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the inverse of Z^T Z</span></span>
<span id="cb11-8"><a aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span> ( <span class="fu">t</span>(Z) <span class="sc">%*%</span> Z )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]          [,2]       [,3]
[1,] 17786.804216 -3556.4700048 -2.4186075
[2,] -3556.470005   711.1358432  0.4644159
[3,]    -2.418608     0.4644159  0.0187805</code></pre>
</div>
</div>
<div style="font-size: 0.1em">
<p><br></p>
</div>
<ul>
<li>In particular, note that the first coefficient is <span class="math inline">\,\, \xi_{11} \, \approx \, 17786</span></li>
</ul>
</div>
</section>
<section id="section-5" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.92em">
<ul>
<li>Let us change the perturbation slightly:</li>
</ul>
<p><span class="math display">
\text{ consider } \, Z_1 + 0.02 \,  \text{ instead of } \, Z_1 + 0.01
</span></p>
<ul>
<li>Invert the new design matrix <span class="math inline">\,\, Z = (Z_1 + 0.02 | Z_2 | Z_3)</span></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Consider perturbation Z1 + 0.02</span></span>
<span id="cb13-2"><a aria-hidden="true" tabindex="-1"></a>PZ1 <span class="ot">&lt;-</span> Z1 <span class="sc">+</span> <span class="fl">0.02</span></span>
<span id="cb13-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Assemble perturbed design matrix</span></span>
<span id="cb13-5"><a aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(PZ1, Z2, Z3), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb13-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the inverse of Z^T Z</span></span>
<span id="cb13-8"><a aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span> ( <span class="fu">t</span>(Z) <span class="sc">%*%</span> Z )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]         [,2]       [,3]
[1,] 4446.701047 -888.8947902 -1.2093038
[2,] -888.894790  177.7098841  0.2225551
[3,]   -1.209304    0.2225551  0.0187805</code></pre>
</div>
</div>
<div style="font-size: 0.1em">
<p><br></p>
</div>
<ul>
<li>In particular, note that the first coefficient is <span class="math inline">\,\, \xi_{11} \, \approx \, 4446</span></li>
</ul>
</div>
</section>
<section id="section-6" class="slide level2 smaller">
<h2></h2>
<ul>
<li><strong>Summary:</strong>
<ul>
<li>If we perturb the vector <span class="math inline">Z_1</span> by <span class="math inline">0.01</span>, the first coefficient of <span class="math inline">(Z^T Z)^{-1}</span> is <span class="math display">
  \xi_{11} \, \approx \, 17786
  </span></li>
<li>If we perturb the vector <span class="math inline">Z_1</span> by <span class="math inline">0.02</span>, the first coefficient of <span class="math inline">(Z^T Z)^{-1}</span> is <span class="math display">
  \xi_{11} \, \approx \, 4446
  </span></li>
</ul></li>
</ul>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<ul>
<li>The average entry in <span class="math inline">Z_1</span> is</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.4</code></pre>
</div>
</div>
</section>
<section id="section-7" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Therefore, the average percentage change in the data <span class="math inline">Z_1</span> is</li>
</ul>
<p><span class="math display">\begin{align*}
\text{Percentage Change} &amp; = \left( \frac{\text{New Value} - \text{Old Value}}{\text{Old Value}} \right) \times 100\% \\[15pts]
                         &amp; = \left(  \frac{(19.4 + 0.02) - (19.4 + 0.01)}{19.4 + 0.01}   \right)  \times 100 \% \ \approx  \ 0.05 \%
\end{align*}</span></p>
<ul>
<li>The percentage change in the coefficients <span class="math inline">\xi_{11}</span> is</li>
</ul>
<p><span class="math display">
\text{Percentage Change in } \, \xi_{11} = \frac{4446 - 17786}{17786} \times 100 \% \ \approx \ 75 \%
</span></p>
</section>
<section id="section-8" class="slide level2 smaller">
<h2></h2>
<ul>
<li><strong>Conclusion:</strong> We have shown that</li>
</ul>
<p><span class="math display">
\text{perturbation of } \, 0.05 \%  \, \text{ in the data } \quad \implies \quad
\text{change of } \, - 75 \%  \, \text{ in } \, \xi_{11}
</span></p>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<ul>
<li>This is precisely <strong>numerical instability</strong></li>
</ul>
<p><span class="math display">
\text{Small perturbations in } Z  \quad \implies \quad \text{large variations in } (Z^T Z)^{-1}
</span></p>
</section>
<section id="causes-of-multicollinearity-1" class="slide level2 smaller">
<h2>Causes of Multicollinearity</h2>
<ul>
<li>Multicollinearity is a problem
<ul>
<li>When are we likely to encounter it?</li>
</ul></li>
<li>Possible sources of Multicollinearity are</li>
</ul>
<ol type="1">
<li><strong>The data collection method employed</strong>
<ul>
<li>Sampling over a limited range of values in the population</li>
</ul></li>
<li><strong>Constraints on the model or population</strong>
<ul>
<li>E.g. variables such as income and house size may be interrelated</li>
</ul></li>
<li><strong>Model Specification</strong>
<ul>
<li>E.g. adding polynomial terms to a model when range of <span class="math inline">X</span>-variables is small</li>
</ul></li>
</ol>
</section>
<section id="section-9" class="slide level2 smaller">
<h2></h2>
<ol start="4" type="1">
<li><strong>An over-determined model</strong>
<ul>
<li>Having too many <span class="math inline">X</span> variables compared to the number of observations</li>
</ul></li>
<li><strong>Common trends</strong>
<ul>
<li>E.g. variables such as consumption, income, wealth, etc may be correlated due to a dependence upon general economic trends and cycles</li>
</ul></li>
</ol>
<p><strong>Often can <em>know in advance</em> when you might experience Multicollinearity</strong></p>
</section>
<section id="how-to-detect-multicollinearity" class="slide level2 smaller">
<h2>How to detect Multicollinearity</h2>
<h3 id="most-important-sign">Most important sign</h3>
<div id="Important*-2.1" class="Important">
<p></p><details class="Important fbx-simplebox fbx-default" open=""><summary><strong>Important</strong></summary><div><strong>High <span class="math inline">R^2</span> values coupled with small t-statistics</strong><p></p>
</div></details>
</div>
<ul>
<li><p>This is a big sign of potential Multicollinearity</p></li>
<li><p>Why is this contradictory?</p>
<ul>
<li>High <span class="math inline">R^2</span> suggests model is good and explains a lot of the variation in <span class="math inline">Y</span></li>
<li>But if individual <span class="math inline">t</span>-statistics are small, this suggests <span class="math inline">\beta_j = 0</span></li>
<li>Hence individual <span class="math inline">X</span>-variables do not affect <span class="math inline">Y</span></li>
</ul></li>
</ul>
</section>
<section id="other-signs-of-multicollinearity" class="slide level2 smaller">
<h2>Other signs of Multicollinearity</h2>
<ol type="1">
<li><strong>Numerical instabilities:</strong>
<ul>
<li>Parameter estimates <span class="math inline">\hat \beta_j</span> become very sensitive to small changes in the data</li>
<li>The <span class="math inline">\mathop{\mathrm{e.s.e.}}</span> become very sensitive to small changes in the data</li>
<li>Parameter estimates <span class="math inline">\hat \beta_j</span> <em>take the wrong sign</em> or otherwise <em>look strange</em></li>
</ul></li>
<li><strong>High correlation between predictors</strong>
<ul>
<li>Correlation can be computed in R</li>
</ul></li>
<li><strong>Kleins rule of thumb:</strong> Multicollinearity will be serious problem if:
<ul>
<li>The <span class="math inline">R^2</span> obtained from regressing predictor variables <span class="math inline">X</span> is greater than the overall <span class="math inline">R^2</span> obtained by regressing <span class="math inline">Y</span> against all the <span class="math inline">X</span> variables</li>
</ul></li>
</ol>
</section>
<section id="what-to-do-in-case-of-multicollinearity" class="slide level2 smaller">
<h2>What to do in case of Multicollinearity?</h2>
<h3 id="do-nothing">Do nothing</h3>
<ul>
<li><p>Multicollinearity is essentially a <strong>data-deficiency problem</strong></p></li>
<li><p>Sometimes we have no control over the dataset available</p></li>
<li><p>Important point:</p>
<ul>
<li>Doing nothing should only be an option in quantitative social sciences (e.g.&nbsp;finance, economics) where data is often difficult to collect</li>
<li>For scientific experiments (e.g.&nbsp;physics, chemistry) one should strive to collect good data</li>
</ul></li>
</ul>
</section>
<section id="what-to-do-in-case-of-multicollinearity-1" class="slide level2 smaller">
<h2>What to do in case of Multicollinearity?</h2>
<h3 id="acquire-newmore-data">Acquire new/more data</h3>
<ul>
<li><p><strong>Multicollinearity is a sample feature</strong></p></li>
<li><p>Possible that another sample involving the same variables will have less Multicollinearity</p></li>
<li><p>Acquiring more data might reduce severity of Multicollinearity</p></li>
<li><p>More data can be collected by either</p>
<ul>
<li>increasing the sample size or</li>
<li>including additional variables</li>
</ul></li>
</ul>
</section>
<section id="what-to-do-in-case-of-multicollinearity-2" class="slide level2 smaller">
<h2>What to do in case of Multicollinearity?</h2>
<h3 id="use-prior-information-about-some-parameters">Use prior information about some parameters</h3>
<ul>
<li><p>To do this properly would require advanced Bayesian statistical methods</p></li>
<li><p>This is beyond the scope of this module</p></li>
</ul>
</section>
<section id="what-to-do-in-case-of-multicollinearity-3" class="slide level2 smaller">
<h2>What to do in case of Multicollinearity?</h2>
<h3 id="rethinking-the-model">Rethinking the model</h3>
<ul>
<li>Sometimes a model chosen for empirical analysis is not carefully thought out
<ul>
<li>Some important variables may be omitted</li>
<li>The functional form of the model may have been incorrectly chosen</li>
</ul></li>
<li>Sometimes using more advanced statistical techniques may be required
<ul>
<li>Factor Analysis</li>
<li>Principal Components Analysis</li>
<li>Ridge Regression</li>
</ul></li>
<li>Above techniques are outside the scope of this module</li>
</ul>
</section>
<section id="what-to-do-in-case-of-multicollinearity-4" class="slide level2 smaller">
<h2>What to do in case of Multicollinearity?</h2>
<h3 id="transformation-of-variables">Transformation of variables</h3>
<ul>
<li><p>Multicollinearity may be reduced by transforming variables</p></li>
<li><p>This may be possible in various different ways</p>
<ul>
<li>E.g. for time-series data one might consider forming a new model by taking first differences</li>
</ul></li>
<li><p>Further reading in Chapter 10 of <span class="citation" data-cites="gujarati_porter">[<a href="#/references" role="doc-biblioref" onclick="">1</a>]</span></p></li>
</ul>
</section>
<section id="what-to-do-in-case-of-multicollinearity-5" class="slide level2 smaller">
<h2>What to do in case of Multicollinearity?</h2>
<h3 id="dropping-variables">Dropping variables</h3>
<ul>
<li><p>Simplest approach to tackle Multicollinearity is to drop one or more of the collinear variables</p></li>
<li><p>Goal: Find the best combination of <span class="math inline">X</span> variables which reduces Multicollinearity</p></li>
<li><p>We present 2 alternatives</p>
<ol type="i">
<li>Dropping variables <em>by hand</em></li>
<li>Dropping variables using <strong>Stepwise regression</strong> (next Part)</li>
</ol></li>
</ul>
</section>
<section id="example-expenditure-vs-income-wealth" class="slide level2 smaller">
<h2>Example: Expenditure Vs Income, Wealth</h2>
<div class="column" style="width:49%;">
<ul>
<li>Explain expenditure <span class="math inline">Y</span> in terms of
<ul>
<li>income <span class="math inline">X_2</span></li>
<li>wealth <span class="math inline">X_3</span></li>
</ul></li>
<li>It is intuitively clear that <em>income</em> and <em>wealth</em> are highly correlated</li>
</ul>
<p><strong>To detect Multicollinearity, look out for</strong></p>
<ul>
<li>High <span class="math inline">R^2</span> value</li>
<li>coupled with low t-values</li>
</ul>
</div><div class="column" style="width:50%;">
<div style="font-size: 0.90em">
<table class="caption-top">
<thead>
<tr class="header">
<th>Expenditure <span class="math inline">Y</span></th>
<th>Income <span class="math inline">X_2</span></th>
<th>Wealth <span class="math inline">X_3</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>70</td>
<td>80</td>
<td>810</td>
</tr>
<tr class="even">
<td>65</td>
<td>100</td>
<td>1009</td>
</tr>
<tr class="odd">
<td>90</td>
<td>120</td>
<td>1273</td>
</tr>
<tr class="even">
<td>95</td>
<td>140</td>
<td>1425</td>
</tr>
<tr class="odd">
<td>110</td>
<td>160</td>
<td>1633</td>
</tr>
<tr class="even">
<td>115</td>
<td>180</td>
<td>1876</td>
</tr>
<tr class="odd">
<td>120</td>
<td>200</td>
<td>2052</td>
</tr>
<tr class="even">
<td>140</td>
<td>220</td>
<td>2201</td>
</tr>
<tr class="odd">
<td>155</td>
<td>240</td>
<td>2435</td>
</tr>
<tr class="even">
<td>150</td>
<td>260</td>
<td>2686</td>
</tr>
</tbody>
</table>
</div>
</div></section>
<section id="fit-the-regression-model-in-r" class="slide level2 smaller">
<h2>Fit the regression model in R</h2>
<ul>
<li>Code for this example is available here <a href="codes/multicollinearity.R">multicollinearity.R</a></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter data</span></span>
<span id="cb17-2"><a aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">65</span>, <span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">110</span>, <span class="dv">115</span>, <span class="dv">120</span>, <span class="dv">140</span>, <span class="dv">155</span>, <span class="dv">150</span>)</span>
<span id="cb17-3"><a aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">140</span>, <span class="dv">160</span>, <span class="dv">180</span>, <span class="dv">200</span>, <span class="dv">220</span>, <span class="dv">240</span>, <span class="dv">260</span>)</span>
<span id="cb17-4"><a aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">810</span>, <span class="dv">1009</span>, <span class="dv">1273</span>, <span class="dv">1425</span>, <span class="dv">1633</span>, <span class="dv">1876</span>, <span class="dv">2052</span>, <span class="dv">2201</span>, <span class="dv">2435</span>, <span class="dv">2686</span>)</span>
<span id="cb17-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb17-7"><a aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2 <span class="sc">+</span> x3)</span>
<span id="cb17-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># We want to display only part of summary</span></span>
<span id="cb17-10"><a aria-hidden="true" tabindex="-1"></a><span class="co"># First capture the output into a vector</span></span>
<span id="cb17-11"><a aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">summary</span>(model))</span>
<span id="cb17-12"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Then print only the lines of interest</span></span>
<span id="cb17-14"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(temp[<span class="dv">9</span><span class="sc">:</span><span class="dv">20</span>], <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-10" class="slide level2 smaller">
<h2></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 24.77473    6.75250   3.669  0.00798 **
x2           0.94154    0.82290   1.144  0.29016   
x3          -0.04243    0.08066  -0.526  0.61509   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.808 on 7 degrees of freedom
Multiple R-squared:  0.9635,    Adjusted R-squared:  0.9531 
F-statistic:  92.4 on 2 and 7 DF,  p-value: 9.286e-06</code></pre>
</div>
</div>
<p><br></p>
<p><strong>Three basic statistics</strong></p>
<ul>
<li><span class="math inline">R^2</span> coefficient</li>
<li>t-statistics and related p-values</li>
<li>F-statistic and related p-value</li>
</ul>
</section>
<section id="section-11" class="slide level2 smaller">
<h2></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 24.77473    6.75250   3.669  0.00798 **
x2           0.94154    0.82290   1.144  0.29016   
x3          -0.04243    0.08066  -0.526  0.61509   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.808 on 7 degrees of freedom
Multiple R-squared:  0.9635,    Adjusted R-squared:  0.9531 
F-statistic:  92.4 on 2 and 7 DF,  p-value: 9.286e-06</code></pre>
</div>
</div>
<p><br></p>
<ol type="1">
<li><span class="math inline">R^2 = 0.9635</span>
<ul>
<li>Model explains a substantial amount of the variation (96.35%) in the data</li>
</ul></li>
</ol>
</section>
<section id="section-12" class="slide level2 smaller">
<h2></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 24.77473    6.75250   3.669  0.00798 **
x2           0.94154    0.82290   1.144  0.29016   
x3          -0.04243    0.08066  -0.526  0.61509   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.808 on 7 degrees of freedom
Multiple R-squared:  0.9635,    Adjusted R-squared:  0.9531 
F-statistic:  92.4 on 2 and 7 DF,  p-value: 9.286e-06</code></pre>
</div>
</div>
<p><br></p>
<ol start="2" type="1">
<li>F-statistic is <span class="math inline">F = 92.4</span>
<ul>
<li>Corresponding p-value is <span class="math inline">p = 9.286 \times 10^{-6} &lt;0.05</span></li>
<li>Evidence that at least one between <em>Income</em> and <em>Wealth</em> affect <em>Expenditure</em></li>
</ul></li>
</ol>
</section>
<section id="section-13" class="slide level2 smaller">
<h2></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 24.77473    6.75250   3.669  0.00798 **
x2           0.94154    0.82290   1.144  0.29016   
x3          -0.04243    0.08066  -0.526  0.61509   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.808 on 7 degrees of freedom
Multiple R-squared:  0.9635,    Adjusted R-squared:  0.9531 
F-statistic:  92.4 on 2 and 7 DF,  p-value: 9.286e-06</code></pre>
</div>
</div>
<p><br></p>
<ol start="3" type="1">
<li>t-statistics:
<ul>
<li>t-statistics for <em>Income</em> is <span class="math inline">t = 1.144</span>; Corresponding p-value is <span class="math inline">p = 0.29016</span></li>
<li>t-statistic for <em>Wealth</em> is <span class="math inline">t = -0.526</span>; Corresponding p-value is <span class="math inline">p = 0.61509</span></li>
<li>Both p-values are <span class="math inline">p &gt; 0.05 \implies</span> regression parameters are <span class="math inline">\beta_2 = \beta_3 = 0</span></li>
<li>Therefore, neither <em>Income</em> nor <em>Wealth</em> affect <em>Expenditure</em></li>
</ul></li>
</ol>
</section>
<section id="the-output-looks-strange" class="slide level2 smaller">
<h2>The output looks strange</h2>
<div style="font-size: 0.93em">
<p><strong>Main red flag for Multicollinearity:</strong></p>
<ul>
<li>High <span class="math inline">R^2</span> value coupled with low t-values (corresponding to high p-values)</li>
</ul>
<p><strong>There are many contradictions:</strong></p>
<ol type="1">
<li><p>High <span class="math inline">R^2</span> value suggests model is really good</p></li>
<li><p>However, low t-values imply neither <em>Income</em> nor <em>Wealth</em> affect <em>Expenditure</em></p></li>
<li><p>F-statistic is high <span class="math inline">\implies</span> at least one between <em>Income</em> or <em>Wealth</em> affect <em>Expenditure</em></p></li>
<li><p>The <em>Wealth</em> estimator has the <em>wrong sign</em> (<span class="math inline">\hat \beta_3 &lt; 0</span>). This makes no sense:</p>
<ul>
<li>it is likely that <em>Expenditure</em> will increase as <em>Wealth</em> increases</li>
<li>therefore, we would expect <span class="math inline">\, \hat \beta_3 &gt; 0</span></li>
</ul></li>
</ol>
<p><strong>Multicollinearity is definitely present!</strong></p>
</div>
</section>
<section id="further-confirmation" class="slide level2 smaller">
<h2>Further confirmation</h2>
<p><strong>Method 1: Computing the correlation:</strong></p>
<ul>
<li>Compute correlation of <span class="math inline">X_2</span> and <span class="math inline">X_3</span></li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x2, x3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9989624</code></pre>
</div>
</div>
<ul>
<li>Correlation is almost 1: Variables <span class="math inline">X_2</span> and <span class="math inline">X_3</span> are very highly correlated</li>
</ul>
<p><strong>This once again confirms Multicollinearity is present</strong></p>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<p><strong>Conclusion:</strong> The variables <em>Income</em> and <em>Wealth</em> are highly correlated</p>
<ul>
<li>Impossible to isolate individual impact of either <em>Income</em> or <em>Wealth</em> upon <em>Expenditure</em></li>
</ul>
</section>
<section id="section-14" class="slide level2 smaller">
<h2></h2>
<p><strong>Method 2: Kleins rule of thumb:</strong> Multicollinearity will be a serious problem if:</p>
<ul>
<li>The <span class="math inline">R^2</span> obtained from regressing predictor variables <span class="math inline">X</span> is greater than the overall <span class="math inline">R^2</span> obtained by regressing <span class="math inline">Y</span> against all the <span class="math inline">X</span> variables</li>
</ul>
<p>In the <em>Expenditure</em> vs <em>Income</em> and <em>Wealth</em> dataset we have:</p>
<ul>
<li><p>Regressing <span class="math inline">Y</span> against <span class="math inline">X_2</span> and <span class="math inline">X_3</span> gives <span class="math inline">R^2=0.9635</span></p></li>
<li><p>Regressing <span class="math inline">X_2</span> against <span class="math inline">X_3</span> gives <span class="math inline">R^2 = 0.9979</span></p></li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb24-2"><a aria-hidden="true" tabindex="-1"></a>klein <span class="ot">&lt;-</span> <span class="fu">lm</span>(x2 <span class="sc">~</span> x3)</span>
<span id="cb24-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Read R^2 in summary</span></span>
<span id="cb24-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(klein)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Kleins rule of thumb suggests that Multicollinearity will be a serious problem</strong></p>
</section>
<section id="addressing-multicollinearity" class="slide level2 smaller">
<h2>Addressing multicollinearity</h2>
<ul>
<li><p>The variables <em>Income</em> and <em>Wealth</em> are highly correlated</p></li>
<li><p>Intuitively, we expect both <em>Income</em> and <em>Wealth</em> to affect <em>Expenditure</em></p></li>
<li><p>Solution can be to <strong>drop</strong> either <em>Income</em> or <em>Wealth</em> variables</p>
<ul>
<li>We can then fit 2 separate models</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit expenditure as function of income</span></span>
<span id="cb25-2"><a aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2)</span>
<span id="cb25-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit expenditure as function of wealth</span></span>
<span id="cb25-5"><a aria-hidden="true" tabindex="-1"></a>model<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3)</span>
<span id="cb25-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.1</span>)</span>
<span id="cb25-8"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="expenditure-vs-income" class="slide level2 smaller">
<h2>Expenditure Vs Income</h2>
<div style="font-size: 0.90em">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 24.45455    6.41382   3.813  0.00514 ** 
x2           0.50909    0.03574  14.243 5.75e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.493 on 8 degrees of freedom
Multiple R-squared:  0.9621,    Adjusted R-squared:  0.9573 
F-statistic: 202.9 on 1 and 8 DF,  p-value: 5.753e-07</code></pre>
</div>
</div>
</div>
<p><br></p>
<div style="font-size: 0.93em">
<ul>
<li><span class="math inline">R^ 2 = 0.9621</span> which is quite high</li>
<li>p-value for <span class="math inline">\beta_2</span> is <span class="math inline">p = 9.8 \times 10^{-7} &lt; 0.05 \quad \implies \quad</span> <em>Income</em> variable is significant</li>
<li>Estimate is <span class="math inline">\hat \beta_2 = 0.50909 &gt; 0</span></li>
</ul>
<p><strong>Strong evidence that <em>Expenditure</em> increases as <em>Income</em> increases</strong></p>
</div>
</section>
<section id="expenditure-vs-wealth" class="slide level2 smaller">
<h2>Expenditure Vs Wealth</h2>
<div style="font-size: 0.90em">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 24.411045   6.874097   3.551   0.0075 ** 
x3           0.049764   0.003744  13.292  9.8e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.938 on 8 degrees of freedom
Multiple R-squared:  0.9567,    Adjusted R-squared:  0.9513 
F-statistic: 176.7 on 1 and 8 DF,  p-value: 9.802e-07</code></pre>
</div>
</div>
</div>
<p><br></p>
<div style="font-size: 0.93em">
<ul>
<li><span class="math inline">R^ 2 = 0.9567</span> which is quite high</li>
<li>p-value for <span class="math inline">\beta_2</span> is <span class="math inline">p = 9.8 \times 10^{-7} &lt; 0.05 \quad \implies \quad</span> <em>Wealth</em> variable is significant</li>
<li>Estimate is <span class="math inline">\hat \beta_2 = 0.049764 &gt; 0</span></li>
</ul>
<p><strong>Strong evidence that <em>Expenditure</em> increases as <em>Wealth</em> increases</strong></p>
</div>
</section>
<section id="example-conclusion" class="slide level2 smaller">
<h2>Example: Conclusion</h2>
<div style="font-size: 0.95em">
<p>First, we fitted the model</p>
<p><span class="math display">
\text{Expenditure} = \beta_1 + \beta_2 \times \text{Wealth} +
\beta_3 \times \text{Income} + \varepsilon
</span></p>
<ul>
<li>We saw that the model performs poorly due to multicollinearity
<ul>
<li>High <span class="math inline">R^2</span> coupled with non-significant variables <em>Income</em> and <em>Wealth</em></li>
<li><em>Income</em> and <em>Wealth</em> are highly correlated</li>
</ul></li>
<li>To address multicollinearity, we dropped variables and fitted simpler models
<ul>
<li><em>Expenditure</em> vs <em>Income</em></li>
<li><em>Expenditure</em> vs <em>Wealth</em></li>
</ul></li>
<li>Both models perform really well
<ul>
<li><em>Expenditure</em> increases as either <em>Income</em> or <em>Wealth</em> increase</li>
</ul></li>
<li><strong>Multicollinearity effects disappeared after dropping either variable!</strong></li>
</ul>
</div>
</section></section>
<section>
<section id="part-2-stepwise-regression" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 2: <br>Stepwise regression</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="stepwise-regression" class="slide level2 smaller">
<h2>Stepwise regression</h2>
<ul>
<li><p>Method for comparing regression models</p></li>
<li><p>Involves iterative selection of predictor variables <span class="math inline">X</span> to use in the model</p></li>
<li><p>It can be achieved through</p>
<ul>
<li>Forward selection</li>
<li>Backward selection</li>
<li>Stepwise selection: Combination of Forward and Backward selection</li>
</ul></li>
</ul>
</section>
<section id="stepwise-regression-methods" class="slide level2 smaller">
<h2>Stepwise regression methods</h2>
<ol type="1">
<li><strong>Forward Selection:</strong> Start with the <strong>null model</strong> with only intercept <span class="math display">
Y = \beta_1 + \varepsilon
</span>
<ul>
<li>Add each variable <span class="math inline">X_j</span> incrementally, testing for significance</li>
<li>Stop when no more variables are statistically significant</li>
</ul></li>
</ol>
<p><strong>Note:</strong> Significance criterion for <span class="math inline">X_j</span> is in terms of <strong>AIC</strong></p>
<ul>
<li>AIC is a measure of how well a model fits the data</li>
<li>AIC is an alternative to the coefficient of determination <span class="math inline">R^2</span></li>
<li>We will give details about AIC later</li>
</ul>
</section>
<section id="section-15" class="slide level2 smaller">
<h2></h2>
<ol start="2" type="1">
<li><strong>Backward Selection:</strong> Start with the <strong>full model</strong> <span class="math display">
Y = \beta_1 + \beta_2 X_{2}+ \ldots+\beta_p X_{p}+ \varepsilon
</span>
<ul>
<li>Delete <span class="math inline">X_j</span> variables which are not significant</li>
<li>Stop when all the remaining variables are significant</li>
</ul></li>
</ol>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ol start="3" type="1">
<li><strong>Stepwise Selection:</strong> Start with the <strong>null model</strong> <span class="math display">
Y = \beta_1 + \varepsilon
</span>
<ul>
<li>Add each variable <span class="math inline">X_j</span> incrementally, testing for significance</li>
<li>Each time a new variable <span class="math inline">X_j</span> is added, perform a Backward Selection step</li>
<li>Stop when all the remaining variables are significant</li>
</ul></li>
</ol>
<p><strong>Note:</strong> Stepwise Selection ensures that at each step all the variables are significant</p>
</section>
<section id="stepwise-regression-in-r" class="slide level2 smaller">
<h2>Stepwise regression in R</h2>
<ul>
<li>Suppose given
<ul>
<li>a data vector <span class="math inline">\, \texttt{y}</span></li>
<li>predictors data <span class="math inline">\, \texttt{x2}, \texttt{x3}, \ldots, \texttt{xp}</span></li>
</ul></li>
<li>Begin by fitting the null and full regression models</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the null model</span></span>
<span id="cb28-2"><a aria-hidden="true" tabindex="-1"></a>null.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb28-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full model</span></span>
<span id="cb28-5"><a aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> ... <span class="sc">+</span> xp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Forward selection or Stepwise selection: Start with <strong>null model</strong></p></li>
<li><p>Backward selection: Start with <strong>full model</strong></p></li>
</ul>
</section>
<section id="section-16" class="slide level2 smaller">
<h2></h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Stepwise selection</span></span>
<span id="cb29-2"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">step</span>(null.model, </span>
<span id="cb29-3"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">"both"</span>, </span>
<span id="cb29-4"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">scope =</span> <span class="fu">formula</span>(full.model))</span>
<span id="cb29-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Forward selection</span></span>
<span id="cb29-8"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">step</span>(null.model, </span>
<span id="cb29-9"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">"forward"</span>, </span>
<span id="cb29-10"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">scope =</span> <span class="fu">formula</span>(full.model))</span>
<span id="cb29-11"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Backward selection</span></span>
<span id="cb29-14"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">step</span>(full.model, </span>
<span id="cb29-15"><a aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">"backward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The model selected by <em>Stepwise regression</em> is saved in
<ul>
<li><span class="math inline">\texttt{best.model}</span></li>
</ul></li>
<li>To find out which model was selected, print the summary and read first 2 lines</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-longley-dataset" class="slide level2 smaller">
<h2>Example: Longley dataset</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     GNP.deflator     GNP Unemployed Armed.Forces Population Year Employed
1947         83.0 234.289      235.6        159.0    107.608 1947   60.323
1948         88.5 259.426      232.5        145.6    108.632 1948   61.122
1949         88.2 258.054      368.2        161.6    109.773 1949   60.171</code></pre>
</div>
</div>
<div style="font-size: 0.30em">
<p><br></p>
</div>
<p><strong>Goal:</strong> Explain the number of <em>Employed</em> people <span class="math inline">Y</span> in the US in terms of</p>
<ul>
<li><span class="math inline">X_2</span> <em>GNP deflator</em> to adjust GNP for inflation</li>
<li><span class="math inline">X_3</span> <em>GNP</em> Gross National Product</li>
<li><span class="math inline">X_4</span> number of <em>Unemployed</em></li>
<li><span class="math inline">X_5</span> number of people in the <em>Armed Forces</em></li>
<li><span class="math inline">X_6</span> <em>non-institutionalised Population</em> <span class="math inline">\geq</span> age 14 (not in care of insitutions)</li>
<li><span class="math inline">X_7</span> <em>Years</em> from 1947 to 1962</li>
</ul>
</section>
<section id="reading-in-the-data" class="slide level2 smaller">
<h2>Reading in the data</h2>
<ul>
<li><p>Code for this example is available here <a href="codes/longley_stepwise.R">longley_stepwise.R</a></p></li>
<li><p>Longley dataset available here <a href="datasets/longley.txt">longley.txt</a></p></li>
<li><p>Download the data file and place it in current working directory</p></li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Read data file</span></span>
<span id="cb32-2"><a aria-hidden="true" tabindex="-1"></a>longley <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file =</span> <span class="st">"longley.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Store columns in vectors</span></span>
<span id="cb32-5"><a aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> longley[ , <span class="dv">1</span>]        <span class="co"># GNP Deflator</span></span>
<span id="cb32-6"><a aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> longley[ , <span class="dv">2</span>]        <span class="co"># GNP</span></span>
<span id="cb32-7"><a aria-hidden="true" tabindex="-1"></a>x4 <span class="ot">&lt;-</span> longley[ , <span class="dv">3</span>]        <span class="co"># Unemployed</span></span>
<span id="cb32-8"><a aria-hidden="true" tabindex="-1"></a>x5 <span class="ot">&lt;-</span> longley[ , <span class="dv">4</span>]        <span class="co"># Armed Forces</span></span>
<span id="cb32-9"><a aria-hidden="true" tabindex="-1"></a>x6 <span class="ot">&lt;-</span> longley[ , <span class="dv">5</span>]        <span class="co"># Population</span></span>
<span id="cb32-10"><a aria-hidden="true" tabindex="-1"></a>x7 <span class="ot">&lt;-</span> longley[ , <span class="dv">6</span>]        <span class="co"># Year</span></span>
<span id="cb32-11"><a aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> longley[ , <span class="dv">7</span>]         <span class="co"># Employed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fitting-the-full-model" class="slide level2 smaller">
<h2>Fitting the Full Model</h2>
<p>Fit the multiple regression model, including all predictors</p>
<p><span class="math display">
Y = \beta_1 + \beta_2 \, X_2 + \beta_3 \, X_3 + \beta_4 \, X_4 + \beta_5 \, X_5
    + \beta_6 \, X_6 + \beta_7 \, X_7 + \varepsilon
</span></p>
<p><br></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit multiple regression model</span></span>
<span id="cb33-2"><a aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> x7)</span>
<span id="cb33-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb33-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-17" class="slide level2 smaller">
<h2></h2>
<div class="columns">
<div class="column" style="width:100%;">
<p><img data-src="images/longley_output_4.png" style="width:72.0%"></p>
</div></div>
<div style="font-size: 0.9em">
<ul>
<li>Fitting the full model gives:
<ul>
<li>Extremely high <span class="math inline">R^2</span> value</li>
<li>Low <span class="math inline">t</span>-values (and high p-values) for <span class="math inline">X_2, X_3</span> and <span class="math inline">X_6</span></li>
</ul></li>
<li>These are signs that we might have a problem with <strong>Multicollinearity</strong></li>
</ul>
</div>
</section>
<section id="section-18" class="slide level2 smaller">
<h2></h2>
<ul>
<li>To further confirm Multicollinearity, we can look at the correlation matrix
<ul>
<li>We can use function <span class="math inline">\, \texttt{cor}</span> directly on first 6 columns of data-frame <span class="math inline">\,\texttt{longley}</span></li>
<li>We look only at correlations larger than <span class="math inline">0.9</span></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Return correlations larger than 0.9</span></span>
<span id="cb34-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(longley[ , <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="sc">&gt;</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>             GNP.deflator   GNP Unemployed Armed.Forces Population  Year
GNP.deflator         TRUE  TRUE      FALSE        FALSE       TRUE  TRUE
GNP                  TRUE  TRUE      FALSE        FALSE       TRUE  TRUE
Unemployed          FALSE FALSE       TRUE        FALSE      FALSE FALSE
Armed.Forces        FALSE FALSE      FALSE         TRUE      FALSE FALSE
Population           TRUE  TRUE      FALSE        FALSE       TRUE  TRUE
Year                 TRUE  TRUE      FALSE        FALSE       TRUE  TRUE</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li>We see that the following pairs are highly correlated (correlation <span class="math inline">\, &gt; 0.9</span>) <span class="math display">
(X_2, X_3)\,, \quad
(X_2, X_6)\,, \quad
(X_2, X_7)\,, \quad
(X_3, X_6)\,, \quad
(X_3, X_7)\,, \quad
(X_6, X_7)
</span></li>
</ul>
</section>
<section id="applying-stepwise-regression" class="slide level2 smaller">
<h2>Applying Stepwise regression</h2>
<ul>
<li><strong>Goal:</strong> Want to find best variables which, at the same time
<ul>
<li>Explain <em>Employment</em> variable <span class="math inline">Y</span></li>
<li>Reduce Multicollinearity</li>
</ul></li>
<li><strong>Method:</strong> We use <em>Stepwise regression</em></li>
</ul>
<div style="font-size: 0.2em">
<p><br></p>
</div>
<ul>
<li>Start by by fitting the null and full regression models</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the null model</span></span>
<span id="cb36-2"><a aria-hidden="true" tabindex="-1"></a>null.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb36-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full model</span></span>
<span id="cb36-5"><a aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> x7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-19" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Perform Stepwise regression by
<ul>
<li>Forward selection</li>
<li>Backward selection</li>
<li>Stepwise selection</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Forward selection</span></span>
<span id="cb37-2"><a aria-hidden="true" tabindex="-1"></a>best.model<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">step</span>(null.model, </span>
<span id="cb37-3"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">direction =</span> <span class="st">"forward"</span>, </span>
<span id="cb37-4"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">scope =</span> <span class="fu">formula</span>(full.model))</span>
<span id="cb37-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Backward selection</span></span>
<span id="cb37-7"><a aria-hidden="true" tabindex="-1"></a>best.model<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">step</span>(full.model, </span>
<span id="cb37-8"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">direction =</span> <span class="st">"backward"</span>)</span>
<span id="cb37-9"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Stepwise selection</span></span>
<span id="cb37-11"><a aria-hidden="true" tabindex="-1"></a>best.model<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">step</span>(null.model, </span>
<span id="cb37-12"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb37-13"><a aria-hidden="true" tabindex="-1"></a>                    <span class="at">scope =</span> <span class="fu">formula</span>(full.model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-20" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Models obtained by Stepwise regression are stored in
<ul>
<li><span class="math inline">\texttt{best.model.1}, \,\, \texttt{best.model.3}, \,\,\texttt{best.model.3}</span></li>
</ul></li>
</ul>
<div style="font-size: 0.2em">
<p><br></p>
</div>
<ul>
<li>Print the summary for each model obtained</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of each model</span></span>
<span id="cb38-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model.x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.2em">
<p><br></p>
</div>
<ul>
<li><strong>Output:</strong> The 3 methods all yield the same model</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb39-1"><a aria-hidden="true" tabindex="-1"></a>Call:</span>
<span id="cb39-2"><a aria-hidden="true" tabindex="-1"></a>lm(formula = y ~ x3 + x4 + x5 + x7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="interpretation" class="slide level2 smaller">
<h2>Interpretation</h2>
<div style="font-size: 0.95em">
<ul>
<li>All three Stepwise regression methods agree:
<ul>
<li><span class="math inline">X_3, X_4, X_5, X_7</span> are selected</li>
<li><span class="math inline">X_2, X_6</span> are excluded</li>
</ul></li>
<li>Recall: When fitting the full model, non-significant variables are <span class="math inline">X_2, X_3, X_6</span>
<ul>
<li>Stepwise regression drops <span class="math inline">X_2, X_6</span>, and keeps <span class="math inline">X_3</span></li>
</ul></li>
<li>Explanation: Multicollinearity between <span class="math inline">X</span>-variables means there is redundancy
<ul>
<li><span class="math inline">X_2</span> and <span class="math inline">X_6</span> are not needed in the model</li>
</ul></li>
<li>This means that the number <em>Employed</em> just depends on
<ul>
<li><span class="math inline">X_3</span> <em>GNP</em></li>
<li><span class="math inline">X_4</span> Number of <em>Unemployed</em> people</li>
<li><span class="math inline">X_5</span> Number of people in the <em>Armed Forces</em></li>
<li><span class="math inline">X_7</span> Time in <em>Years</em></li>
</ul></li>
</ul>
</div>
</section>
<section id="re-fitting-the-model-without-x_2-and-x_6" class="slide level2 smaller">
<h2>Re-fitting the model without <span class="math inline">X_2</span> and <span class="math inline">X_6</span></h2>
<div style="font-size: 0.9em">
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x7)</span>
<span id="cb40-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="verbatim"><code>Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -3.599e+03  7.406e+02  -4.859 0.000503 ***
x3          -4.019e-02  1.647e-02  -2.440 0.032833 *  
x4          -2.088e-02  2.900e-03  -7.202 1.75e-05 ***
x5          -1.015e-02  1.837e-03  -5.522 0.000180 ***
x7           1.887e+00  3.828e-01   4.931 0.000449 ***
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 0.2794 on 11 degrees of freedom
Multiple R-squared:  0.9954,    Adjusted R-squared:  0.9937 
F-statistic: 589.8 on 4 and 11 DF,  p-value: 9.5e-13</code></pre>
</div>
<ul>
<li>Coefficient of determination is still very high: <span class="math inline">R^2 = 0.9954</span></li>
<li>All the variables <span class="math inline">X_3, X_4,X_5,X_7</span> are significant (p-values <span class="math inline">&lt;0.05</span>)</li>
<li>This means Multicollinearity effects have disappeared</li>
</ul>
</section>
<section id="re-fitting-the-model-without-x_2-and-x_6-1" class="slide level2 smaller">
<h2>Re-fitting the model without <span class="math inline">X_2</span> and <span class="math inline">X_6</span></h2>
<div style="font-size: 0.9em">
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x7)</span>
<span id="cb42-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="verbatim"><code>Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -3.599e+03  7.406e+02  -4.859 0.000503 ***
x3          -4.019e-02  1.647e-02  -2.440 0.032833 *  
x4          -2.088e-02  2.900e-03  -7.202 1.75e-05 ***
x5          -1.015e-02  1.837e-03  -5.522 0.000180 ***
x7           1.887e+00  3.828e-01   4.931 0.000449 ***
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 0.2794 on 11 degrees of freedom
Multiple R-squared:  0.9954,    Adjusted R-squared:  0.9937 
F-statistic: 589.8 on 4 and 11 DF,  p-value: 9.5e-13</code></pre>
</div>
<ul>
<li>The coefficient of <span class="math inline">X_3</span> is negative and statistically significant
<ul>
<li>As <em>GNP</em> increases the number <em>Employed</em> decreases</li>
</ul></li>
<li>The coefficient of <span class="math inline">X_4</span> is negative and statistically significant
<ul>
<li>As the number of <em>Unemployed</em> increases the number <em>Employed</em> decreases</li>
</ul></li>
</ul>
</section>
<section id="re-fitting-the-model-without-x_2-and-x_6-2" class="slide level2 smaller">
<h2>Re-fitting the model without <span class="math inline">X_2</span> and <span class="math inline">X_6</span></h2>
<div style="font-size: 0.9em">
<div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x7)</span>
<span id="cb44-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="verbatim"><code>Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -3.599e+03  7.406e+02  -4.859 0.000503 ***
x3          -4.019e-02  1.647e-02  -2.440 0.032833 *  
x4          -2.088e-02  2.900e-03  -7.202 1.75e-05 ***
x5          -1.015e-02  1.837e-03  -5.522 0.000180 ***
x7           1.887e+00  3.828e-01   4.931 0.000449 ***
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 0.2794 on 11 degrees of freedom
Multiple R-squared:  0.9954,    Adjusted R-squared:  0.9937 
F-statistic: 589.8 on 4 and 11 DF,  p-value: 9.5e-13</code></pre>
</div>
<ul>
<li>The coefficient of <span class="math inline">X_5</span> is negative and statistically significant
<ul>
<li>As the number of <em>Armed Forces</em> increases the number <em>Employed</em> decreases</li>
</ul></li>
<li>The coefficient of <span class="math inline">X_7</span> is positive and statistically significant
<ul>
<li>the number <em>Employed</em> is generally increasing over <em>Time</em></li>
</ul></li>
</ul>
</section>
<section id="re-fitting-the-model-without-x_2-and-x_6-3" class="slide level2 smaller">
<h2>Re-fitting the model without <span class="math inline">X_2</span> and <span class="math inline">X_6</span></h2>
<div style="font-size: 0.9em">
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x7)</span>
<span id="cb46-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="verbatim"><code>Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -3.599e+03  7.406e+02  -4.859 0.000503 ***
x3          -4.019e-02  1.647e-02  -2.440 0.032833 *  
x4          -2.088e-02  2.900e-03  -7.202 1.75e-05 ***
x5          -1.015e-02  1.837e-03  -5.522 0.000180 ***
x7           1.887e+00  3.828e-01   4.931 0.000449 ***
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 0.2794 on 11 degrees of freedom
Multiple R-squared:  0.9954,    Adjusted R-squared:  0.9937 
F-statistic: 589.8 on 4 and 11 DF,  p-value: 9.5e-13</code></pre>
</div>
<ul>
<li><strong>Apparent contradiction:</strong> The interpretation for <span class="math inline">X_3</span> appears contradictory
<ul>
<li>We would expect that as <em>GNP</em> increases the number of <em>Employed</em> increases</li>
<li>This is not the case, because the effect of <span class="math inline">X_3</span> is dwarfed by the general increase in <em>Employment</em> over <em>Time</em> (<span class="math inline">X_7</span> has large coefficient)</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="part-3-stepwise-regression-and-overfitting" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 3: <br>Stepwise regression <br> and overfitting</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="on-the-coefficient-of-determination-r2" class="slide level2 smaller">
<h2>On the coefficient of determination <span class="math inline">R^2</span></h2>
<ul>
<li>Recall the formula for the <span class="math inline">R^2</span> coefficient of determination</li>
</ul>
<p><span class="math display">
R^2 = 1 - \frac{\mathop{\mathrm{RSS}}}{\mathop{\mathrm{TSS}}}
</span></p>
<ul>
<li>It always holds that</li>
</ul>
<p><span class="math display">
R^2 \leq 1
</span></p>
<ul>
<li>We used <span class="math inline">R^2</span> to measure how well a regression model fits the data
<ul>
<li>Large <span class="math inline">R^2</span> implies good fit</li>
<li>Small <span class="math inline">R^2</span> implies bad fit</li>
</ul></li>
</ul>
</section>
<section id="revisiting-the-galileo-example" class="slide level2 smaller">
<h2>Revisiting the Galileo example</h2>
<p><strong>Drawback:</strong> <span class="math inline">R^2</span> increases when number of predictors increases</p>
<ul>
<li><p>We saw this phenomenon in the <strong>Galileo</strong> example in Lecture 10</p></li>
<li><p>Fitting the simple model <span class="math display">
  \rm{distance} = \beta_1 + \beta_2 \, \rm{height}  + \varepsilon
</span> gave <span class="math inline">R^2 = 0.9264</span></p></li>
<li><p>In contrast the quadratic, cubic, and quartic models gave, respectively <span class="math display">
R^2 = 0.9903 \,, \qquad R^2 = 0.9994 \,, \qquad
R^2 = 0.9998
</span></p></li>
<li><p>Fitting a higher degree polynomial gives higher <span class="math inline">R^2</span></p></li>
</ul>
</section>
<section id="section-21" class="slide level2 smaller">
<h2></h2>
<p><strong>Conclusion:</strong> If the degree of the polynomial is sufficiently high, we can get <span class="math inline">R^2 = 1</span></p>
<ul>
<li>Indeed, there always exist a polynomial passing exactly through the data points</li>
</ul>
<p><span class="math display">
(\rm{height}_1, \rm{distance}_1) \,, \ldots , (\rm{height}_n, \rm{distance}_n)
</span></p>
<ul>
<li>For such polynomial model, the predictions match the data perfectly</li>
</ul>
<p><span class="math display">
\hat y_i = y_i \,, \qquad \forall \,\, i = 1 , \ldots, n
</span></p>
<ul>
<li>Therefore we have</li>
</ul>
<p><span class="math display">
\mathop{\mathrm{RSS}}= \sum_{i=1}^n (y_i - \hat y_i )^2 = 0 \qquad \implies
\qquad R^2 = 1
</span></p>
</section>
<section id="overfitting-the-data" class="slide level2 smaller">
<h2>Overfitting the data</h2>
<div style="font-size: 0.95em">
<p><strong>Warning:</strong> Adding increasingly higher number of parameters is not always good</p>
<ul>
<li>It might lead to a phenomenon called <strong>overfitting</strong>
<ul>
<li>The model fits the data very well</li>
<li>However the model does not make good predictions</li>
</ul></li>
</ul>
<p><strong>Example 1:</strong> In the Galileo example, we saw that</p>
<ul>
<li><span class="math inline">R^2</span> increases when adding higher order terms</li>
<li>Howevever, the F-test for Model Slection tells us that the order 3 model is best</li>
<li>Going to 4th order improves <span class="math inline">R^2</span>, but makes predictions worse<br>
(as detected by F-test for Model Selection comparing Order 3 and 4 models)</li>
</ul>
<p><strong>Example 2:</strong> In the <strong>Divorces</strong> example, however, things were different</p>
</div>
</section>
<section id="revisiting-the-divorces-example" class="slide level2 smaller">
<h2>Revisiting the Divorces example</h2>
<div class="column" style="width:46%;">
<div class="cell">
<details class="code-fold">
<summary>Click here to show the full code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Divorces data</span></span>
<span id="cb48-2"><a aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb48-3"><a aria-hidden="true" tabindex="-1"></a>percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">3.51</span>, <span class="fl">9.5</span>, <span class="fl">8.91</span>, <span class="fl">9.35</span>, <span class="fl">8.18</span>, <span class="fl">6.43</span>, <span class="fl">5.31</span>, </span>
<span id="cb48-4"><a aria-hidden="true" tabindex="-1"></a>             <span class="fl">5.07</span>, <span class="fl">3.65</span>, <span class="fl">3.8</span>, <span class="fl">2.83</span>, <span class="fl">1.51</span>, <span class="fl">1.27</span>, <span class="fl">0.49</span>)</span>
<span id="cb48-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model</span></span>
<span id="cb48-7"><a aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year)</span>
<span id="cb48-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit order 6 model</span></span>
<span id="cb48-10"><a aria-hidden="true" tabindex="-1"></a>order_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year  <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">3</span> ) <span class="sc">+</span> </span>
<span id="cb48-11"><a aria-hidden="true" tabindex="-1"></a>                                <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">4</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb48-12"><a aria-hidden="true" tabindex="-1"></a>                                <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">6</span> ))</span>
<span id="cb48-13"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot of data</span></span>
<span id="cb48-15"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(year, percent, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb48-16"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels</span></span>
<span id="cb48-18"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Years of marriage"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb48-19"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Risk of divorce"</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.5</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb48-20"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Linear Vs Quadratic</span></span>
<span id="cb48-22"><a aria-hidden="true" tabindex="-1"></a>polynomial <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x, ps) {</span>
<span id="cb48-23"><a aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(ps)</span>
<span id="cb48-24"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(ps<span class="sc">*</span>x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>n<span class="dv">-1</span>))</span>
<span id="cb48-25"><a aria-hidden="true" tabindex="-1"></a>}, <span class="st">"x"</span>)</span>
<span id="cb48-26"><a aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">polynomial</span>(x, <span class="fu">coef</span>(linear)), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb48-27"><a aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">polynomial</span>(x, <span class="fu">coef</span>(order_6)), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb48-28"><a aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Order 6"</span>), </span>
<span id="cb48-29"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-16-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<p><br></p>
<ul>
<li><p>The best model seems to be Linear <span class="math display">
y = \beta_1 + \beta_2 x + \varepsilon
</span></p></li>
<li><p>Linear model interpretation:</p>
<ul>
<li>The risk of divorce is decreasing in time</li>
<li>The risk peak in year 2 is explained by unusually low risk in year 1</li>
</ul></li>
</ul>
</div></section>
<section id="revisiting-the-divorces-example-1" class="slide level2 smaller">
<h2>Revisiting the Divorces example</h2>
<div class="column" style="width:46%;">
<div class="cell">
<details class="code-fold">
<summary>Click here to show the full code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Divorces data</span></span>
<span id="cb49-2"><a aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb49-3"><a aria-hidden="true" tabindex="-1"></a>percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">3.51</span>, <span class="fl">9.5</span>, <span class="fl">8.91</span>, <span class="fl">9.35</span>, <span class="fl">8.18</span>, <span class="fl">6.43</span>, <span class="fl">5.31</span>, </span>
<span id="cb49-4"><a aria-hidden="true" tabindex="-1"></a>             <span class="fl">5.07</span>, <span class="fl">3.65</span>, <span class="fl">3.8</span>, <span class="fl">2.83</span>, <span class="fl">1.51</span>, <span class="fl">1.27</span>, <span class="fl">0.49</span>)</span>
<span id="cb49-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model</span></span>
<span id="cb49-7"><a aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year)</span>
<span id="cb49-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit order 6 model</span></span>
<span id="cb49-10"><a aria-hidden="true" tabindex="-1"></a>order_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year  <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">3</span> ) <span class="sc">+</span> </span>
<span id="cb49-11"><a aria-hidden="true" tabindex="-1"></a>                                <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">4</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb49-12"><a aria-hidden="true" tabindex="-1"></a>                                <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">6</span> ))</span>
<span id="cb49-13"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot of data</span></span>
<span id="cb49-15"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(year, percent, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb49-16"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels</span></span>
<span id="cb49-18"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Years of marriage"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb49-19"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Risk of divorce"</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.5</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb49-20"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Linear Vs Quadratic</span></span>
<span id="cb49-22"><a aria-hidden="true" tabindex="-1"></a>polynomial <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x, ps) {</span>
<span id="cb49-23"><a aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(ps)</span>
<span id="cb49-24"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(ps<span class="sc">*</span>x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>n<span class="dv">-1</span>))</span>
<span id="cb49-25"><a aria-hidden="true" tabindex="-1"></a>}, <span class="st">"x"</span>)</span>
<span id="cb49-26"><a aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">polynomial</span>(x, <span class="fu">coef</span>(linear)), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb49-27"><a aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">polynomial</span>(x, <span class="fu">coef</span>(order_6)), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb49-28"><a aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Order 6"</span>), </span>
<span id="cb49-29"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-17-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<p><br></p>
<ul>
<li>However, fitting <em>Order 6</em> polynomial yields better results
<ul>
<li>The coefficient <span class="math inline">R^2</span> increases (of course!)</li>
<li>F-test for Model Selection prefers <em>Order 6</em> model to the linear one</li>
</ul></li>
<li>Statistically, <em>Order 6</em> model is better than <em>Linear</em> model
<ul>
<li>In the sense that <em>Order 6</em> makes better predictions</li>
</ul></li>
</ul>
</div></section>
<section id="revisiting-the-divorces-example-2" class="slide level2 smaller">
<h2>Revisiting the Divorces example</h2>
<div class="column" style="width:46%;">
<div class="cell">
<details class="code-fold">
<summary>Click here to show the full code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Divorces data</span></span>
<span id="cb50-2"><a aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb50-3"><a aria-hidden="true" tabindex="-1"></a>percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">3.51</span>, <span class="fl">9.5</span>, <span class="fl">8.91</span>, <span class="fl">9.35</span>, <span class="fl">8.18</span>, <span class="fl">6.43</span>, <span class="fl">5.31</span>, </span>
<span id="cb50-4"><a aria-hidden="true" tabindex="-1"></a>             <span class="fl">5.07</span>, <span class="fl">3.65</span>, <span class="fl">3.8</span>, <span class="fl">2.83</span>, <span class="fl">1.51</span>, <span class="fl">1.27</span>, <span class="fl">0.49</span>)</span>
<span id="cb50-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model</span></span>
<span id="cb50-7"><a aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year)</span>
<span id="cb50-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit order 6 model</span></span>
<span id="cb50-10"><a aria-hidden="true" tabindex="-1"></a>order_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year  <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">3</span> ) <span class="sc">+</span> </span>
<span id="cb50-11"><a aria-hidden="true" tabindex="-1"></a>                                <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">4</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb50-12"><a aria-hidden="true" tabindex="-1"></a>                                <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">6</span> ))</span>
<span id="cb50-13"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot of data</span></span>
<span id="cb50-15"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(year, percent, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb50-16"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels</span></span>
<span id="cb50-18"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Years of marriage"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb50-19"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Risk of divorce"</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.5</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb50-20"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Linear Vs Quadratic</span></span>
<span id="cb50-22"><a aria-hidden="true" tabindex="-1"></a>polynomial <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x, ps) {</span>
<span id="cb50-23"><a aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(ps)</span>
<span id="cb50-24"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(ps<span class="sc">*</span>x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span>n<span class="dv">-1</span>))</span>
<span id="cb50-25"><a aria-hidden="true" tabindex="-1"></a>}, <span class="st">"x"</span>)</span>
<span id="cb50-26"><a aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">polynomial</span>(x, <span class="fu">coef</span>(linear)), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb50-27"><a aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">polynomial</span>(x, <span class="fu">coef</span>(order_6)), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb50-28"><a aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Order 6"</span>), </span>
<span id="cb50-29"><a aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-18-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<ul>
<li>However, looking at the plot:
<ul>
<li><em>Order 6</em> model introduces unnatural spike at 27 years</li>
<li>This is a sign of <em>overfitting</em></li>
</ul></li>
<li>Question:
<ul>
<li><span class="math inline">R^2</span> coefficient and F-test are in favor of <em>Order 6</em> model</li>
<li>How do we rule out <em>Order 6</em> model?</li>
</ul></li>
<li>Answer: We need a new measure for comparing regression models
<ul>
<li>AIC</li>
</ul></li>
</ul>
</div></section>
<section id="akaike-information-criterion-aic" class="slide level2 smaller">
<h2>Akaike information criterion (AIC)</h2>
<ul>
<li><p>The AIC is a number which measures how well a regression model fits the data</p></li>
<li><p>Also <span class="math inline">R^2</span> measures how well a regression model fits the data</p></li>
<li><p>The difference between AIC and <span class="math inline">R^2</span> is that AIC also <strong>accounts for overfitting</strong></p></li>
</ul>
<div id="Definition*-4.1" class="Definition">
<details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition</strong></summary><div>
<p>The AIC is</p>
<p><span class="math display">
{\rm AIC} := 2p - 2 \log ( \hat{L} )
</span></p>
<ul>
<li><p><span class="math inline">p =</span> number of parameters in the model</p></li>
<li><p><span class="math inline">\hat{L} =</span> maximum value of the likelihood function</p></li>
</ul>
</div></details>
</div>
</section>
<section id="rewriting-the-aic" class="slide level2 smaller">
<h2>Rewriting the AIC</h2>
<ul>
<li>In past lectures, we have shown that general regression satisfies</li>
</ul>
<p><span class="math display">
\log(\hat L)=
-\frac{n}{2}\log(2\pi) - \frac{n}{2}\log(\hat\sigma^2) - \frac{1}{2\hat\sigma^2} \mathop{\mathrm{RSS}}\,, \qquad \hat \sigma^2 := \frac{\mathop{\mathrm{RSS}}}{n}
</span></p>
<ul>
<li>Therefore</li>
</ul>
<p><span class="math display">
\log(\hat L)= - \frac{n}{2}  \log \left( \frac{\mathop{\mathrm{RSS}}}{n}  \right) + C
</span></p>
<ul>
<li><p><span class="math inline">C</span> is constant depending only on the number of sample points</p></li>
<li><p>Thus, <span class="math inline">C</span> does not change if the data does not change</p></li>
</ul>
</section>
<section id="akaike-information-criterion-aic-1" class="slide level2 smaller">
<h2>Akaike information criterion (AIC)</h2>
<ul>
<li>We obtain the following equivalent formula for AIC</li>
</ul>
<p><span class="math display">
{\rm AIC} = 2p + n \log \left( \frac{ \mathop{\mathrm{RSS}}}{n} \right) - 2C
</span></p>
<ul>
<li>We now see that AIC accounts for
<ul>
<li><strong>Data fit:</strong> since the data fit term <span class="math inline">\mathop{\mathrm{RSS}}</span> is present</li>
<li><strong>Model complexity:</strong> Since the number of degrees of freedom <span class="math inline">p</span> is present</li>
</ul></li>
<li>Therefore, a model with low AIC is such that:
<ol type="1">
<li>Model fits data well</li>
<li>Model is not too complex, preventing overfitting</li>
</ol></li>
<li>Conclusion: sometimes AIC is better than <span class="math inline">R^2</span> when comparing two models</li>
</ul>
</section>
<section id="stepwise-regression-and-aic" class="slide level2 smaller">
<h2>Stepwise regression and AIC</h2>
<ul>
<li><em>Stepwise regression</em> function in R uses AIC to compare models
<ul>
<li>the model with <strong>lowest AIC</strong> is selected</li>
</ul></li>
<li>Hence, Stepwise regression outputs the model which, at the same time
<ol type="1">
<li>Best fits the given data</li>
<li>Prevents overfitting</li>
</ol></li>
<li><strong>Example:</strong> Apply Stepwise regression to <strong>divorces</strong> examples to compare
<ul>
<li>Linear model</li>
<li>Order 6 model</li>
</ul></li>
</ul>
</section>
<section id="example-divorces" class="slide level2 smaller">
<h2>Example: Divorces</h2>
<div class="column" style="width:48%;">
<div class="cell">
<details class="code-fold">
<summary>Click here to show the full code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Divorces data</span></span>
<span id="cb51-2"><a aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb51-3"><a aria-hidden="true" tabindex="-1"></a>percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">3.51</span>, <span class="fl">9.5</span>, <span class="fl">8.91</span>, <span class="fl">9.35</span>, <span class="fl">8.18</span>, <span class="fl">6.43</span>, <span class="fl">5.31</span>, </span>
<span id="cb51-4"><a aria-hidden="true" tabindex="-1"></a>             <span class="fl">5.07</span>, <span class="fl">3.65</span>, <span class="fl">3.8</span>, <span class="fl">2.83</span>, <span class="fl">1.51</span>, <span class="fl">1.27</span>, <span class="fl">0.49</span>)</span>
<span id="cb51-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot of data</span></span>
<span id="cb51-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(year, percent, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb51-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels</span></span>
<span id="cb51-10"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Years of marriage"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span>
<span id="cb51-11"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Risk of divorce"</span>, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="fl">2.5</span>, <span class="at">cex =</span> <span class="fl">2.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-19-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:48%;">
<div style="font-size: 0.72em">
<table class="caption-top" style="width:50%;">
<colgroup>
<col style="width: 30%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Years of Marriage</strong></th>
<th style="text-align: left;"><strong>% divorces</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">3.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">9.50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">8.91</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">9.35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">8.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">6.43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">5.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">5.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: left;">3.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: left;">3.80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: left;">2.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">20</td>
<td style="text-align: left;">1.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25</td>
<td style="text-align: left;">1.27</td>
</tr>
<tr class="even">
<td style="text-align: left;">30</td>
<td style="text-align: left;">0.49</td>
</tr>
</tbody>
</table>
</div>
</div></section>
<section id="fitting-the-null-model" class="slide level2 smaller">
<h2>Fitting the null model</h2>
<ul>
<li><p>Code for this example available here <a href="codes/divorces_stepwise.R">divorces_stepwise.R</a></p></li>
<li><p>First we import the data into R</p></li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Divorces data</span></span>
<span id="cb52-2"><a aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb52-3"><a aria-hidden="true" tabindex="-1"></a>percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">3.51</span>, <span class="fl">9.5</span>, <span class="fl">8.91</span>, <span class="fl">9.35</span>, <span class="fl">8.18</span>, <span class="fl">6.43</span>, <span class="fl">5.31</span>, </span>
<span id="cb52-4"><a aria-hidden="true" tabindex="-1"></a>             <span class="fl">5.07</span>, <span class="fl">3.65</span>, <span class="fl">3.8</span>, <span class="fl">2.83</span>, <span class="fl">1.51</span>, <span class="fl">1.27</span>, <span class="fl">0.49</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The null model is</li>
</ul>
<p><span class="math display">
{\rm percent} = \beta_1 + \varepsilon
</span></p>
<ul>
<li>Fit the null model with</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a aria-hidden="true" tabindex="-1"></a>null.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fitting-the-full-model-1" class="slide level2 smaller">
<h2>Fitting the full model</h2>
<ul>
<li>The full model is the <em>Order 6</em> model</li>
</ul>
<p><span class="math display">
\rm{percent} = \beta_1 + \beta_2 \, {\rm year} +
\beta_3 \, {\rm year}^2 + \ldots + \beta_7 \, {\rm year}^6
</span></p>
<ul>
<li>Fit the full model with</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(percent <span class="sc">~</span> year  <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">3</span> ) <span class="sc">+</span> </span>
<span id="cb54-2"><a aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">4</span> ) <span class="sc">+</span> <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb54-3"><a aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">I</span>( year<span class="sc">^</span><span class="dv">6</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="stepwise-regression-1" class="slide level2 smaller">
<h2>Stepwise regression</h2>
<p>We run stepwise regression and save the best model:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a aria-hidden="true" tabindex="-1"></a>best.model <span class="ot">&lt;-</span> <span class="fu">step</span>(null.model, </span>
<span id="cb55-2"><a aria-hidden="true" tabindex="-1"></a>                  <span class="at">direction =</span> <span class="st">"both"</span>, </span>
<span id="cb55-3"><a aria-hidden="true" tabindex="-1"></a>                  <span class="at">scope =</span> <span class="fu">formula</span>(full.model)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<ul>
<li>The selected model is <em>linear</em>, not the <em>Order 6</em> polynomial!</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="verbatim"><code>
Call:
lm(formula = percent ~ year)

.....
</code></pre>
<ul>
<li>To understand how <code>step</code> made this choice, let us examine its output</li>
</ul>
</section>
<section id="section-22" class="slide level2 smaller">
<h2></h2>
<div class="column" style="width:49%;">
<div style="font-size: 0.88em">
<pre class="verbatim"><code>Start:  AIC=32.46
percent ~ 1

            Df Sum of Sq     RSS    AIC
+ year       1    80.966  42.375 19.505
+ I(year^2)  1    68.741  54.600 23.054
+ I(year^3)  1    56.724  66.617 25.839
+ I(year^4)  1    48.335  75.006 27.499
+ I(year^5)  1    42.411  80.930 28.563
+ I(year^6)  1    38.068  85.273 29.295
&lt;none&gt;                   123.341 32.463</code></pre>
</div>
</div><div class="column" style="width:49%;">
<div style="font-size: 0.88em">
<pre class="verbatim"><code>Step:  AIC=19.5
percent ~ year

            Df Sum of Sq     RSS    AIC
&lt;none&gt;                    42.375 19.505
+ I(year^4)  1     3.659  38.716 20.241
+ I(year^3)  1     3.639  38.736 20.248
+ I(year^5)  1     3.434  38.941 20.322
+ I(year^6)  1     3.175  39.200 20.415
+ I(year^2)  1     2.826  39.549 20.539
- year       1    80.966 123.341 32.463</code></pre>
</div>
</div><div style="font-size: 0.15em">
<p><br></p>
</div>
<div style="font-size: 0.88em">
<ul>
<li>The first part of the output is on the left<br>
</li>
<li>As requested, <code>step</code> begins with the <em>null model</em>: <code>percent ~ 1</code><br>
</li>
<li>This model has an AIC of <span class="math inline">32.46</span><br>
</li>
<li><code>step</code> then tests adding each variable from the <em>full model</em> one at a time<br>
</li>
<li>This includes all polynomial terms: <code>+ I(year^k)</code><br>
</li>
<li>For each, it computes the AIC and ranks the terms by lowest value<br>
</li>
<li>The largest improvement comes from adding <code>year</code>. Therefore, the variable <code>year</code> is selected</li>
<li>This means the current best model is: <code>percent ~ year</code></li>
</ul>
</div>
</section>
<section id="section-23" class="slide level2 smaller">
<h2></h2>
<div class="column" style="width:49%;">
<div style="font-size: 0.88em">
<pre class="verbatim"><code>Start:  AIC=32.46
percent ~ 1

            Df Sum of Sq     RSS    AIC
+ year       1    80.966  42.375 19.505
+ I(year^2)  1    68.741  54.600 23.054
+ I(year^3)  1    56.724  66.617 25.839
+ I(year^4)  1    48.335  75.006 27.499
+ I(year^5)  1    42.411  80.930 28.563
+ I(year^6)  1    38.068  85.273 29.295
&lt;none&gt;                   123.341 32.463</code></pre>
</div>
</div><div class="column" style="width:49%;">
<div style="font-size: 0.88em">
<pre class="verbatim"><code>Step:  AIC=19.5
percent ~ year

            Df Sum of Sq     RSS    AIC
&lt;none&gt;                    42.375 19.505
+ I(year^4)  1     3.659  38.716 20.241
+ I(year^3)  1     3.639  38.736 20.248
+ I(year^5)  1     3.434  38.941 20.322
+ I(year^6)  1     3.175  39.200 20.415
+ I(year^2)  1     2.826  39.549 20.539
- year       1    80.966 123.341 32.463</code></pre>
</div>
</div><div style="font-size: 0.15em">
<p><br></p>
</div>
<div style="font-size: 0.88em">
<ul>
<li>Second part of output is on the right: <code>step</code> resumes from the best model <code>percent ~ year</code><br>
</li>
<li>R considers:
<ul>
<li>doing nothing (<code>&lt;none&gt;</code>), i.e.&nbsp;keeping the current model<br>
</li>
<li>adding more predictors (polynomials: <code>+ I(year^k)</code>)<br>
</li>
<li>removing the year predictor (<code>- year</code>)<br>
</li>
</ul></li>
<li>For each option, R computes the AIC and ranks them by lowest value</li>
<li>The lowest AIC comes from doing nothing  the current model is already best</li>
<li>Running <code>step</code> again would yield the same result. Thus, the final model is: <code>percent ~ year</code></li>
</ul>
</div>
</section>
<section id="conclusions" class="slide level2 smaller">
<h2>Conclusions</h2>
<ul>
<li>Old conclusions (Lecture 10):
<ul>
<li><em>Linear model</em> has lower <span class="math inline">R^2</span> than <em>Order 6 model</em></li>
<li>F-test for Model Selection chooses <em>Order 6 model</em> over <em>Linear model</em></li>
<li>Hence <em>Order 6 model</em> seems better than <em>Linear model</em></li>
</ul></li>
<li>New conclusions:
<ul>
<li>Stepwise regression chooses <em>Linear model</em> over <em>Order 6 model</em></li>
</ul></li>
<li><strong>Bottom line:</strong> The new findings are in line with our intuition:
<ul>
<li><em>Order 6</em> model overfits</li>
<li>Therefore the <em>Linear model</em> should be preferred</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="part-4-one-way-anova" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 4: <br> One-way ANOVA</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="introduction" class="slide level2 smaller">
<h2>Introduction</h2>
<ul>
<li><p>ANOVA means <em>Analysis of variance</em></p></li>
<li><p>Method of comparing means across samples</p></li>
<li><p>We first present ANOVA in the traditional way</p></li>
<li><p>Then we show that the ANOVA model is just a special form of linear regression</p>
<ul>
<li>In particular, ANOVA models can be fitted with <code>lm</code></li>
</ul></li>
</ul>
</section>
<section id="one-way-anova" class="slide level2 smaller">
<h2>One-way ANOVA</h2>
<ul>
<li>ANOVA allows to compare population means for several independent samples
<ul>
<li>Can be seen as generalization of t-test for two independent samples</li>
</ul></li>
<li>Suppose we have <span class="math inline">k</span> populations of interest, with distribution <span class="math inline">N(\mu_k,\sigma^2)</span>
<ul>
<li>Note that the variance is the same for all populations</li>
</ul></li>
<li>Sample from population <span class="math inline">i</span> is denoted <span class="math inline">x_{i1}, x_{i2}, \ldots , x_{in_i}</span></li>
</ul>
<p><strong>Goal</strong>: Compare population means <span class="math inline">\mu_i</span></p>
<p><strong>Hypothesis set:</strong> We test for a difference in means</p>
<p><span class="math display">\begin{align*}
H_0 \colon  &amp; \mu_1 = \mu_2 = \ldots = \mu_k \\
H_1 \colon &amp; \mu_i \neq \mu_j \,\, \text{ for at least one pair } \, i \neq j
\end{align*}</span></p>
<p><strong>ANOVA is generalization of two-sample t-test to multiple populations</strong></p>
</section>
<section id="constructing-a-test-statistic" class="slide level2 smaller">
<h2>Constructing a Test statistic</h2>
<ul>
<li>We formulate a statistic which compares
<ul>
<li>variations within a single group to</li>
<li>variations among the groups</li>
</ul></li>
<li>Denote the mean of the i-th sample by</li>
</ul>
<p><span class="math display">
\overline{x}_i = \frac{1}{n_i} \sum_{j=1}^{n_i} x_{ij}
</span></p>
<ul>
<li>Denote the <em>grand mean</em> of all samples by</li>
</ul>
<p><span class="math display">
\overline{x} = \frac{1}{k} \sum_{i=1}^k  \overline{x}_i  =  \frac{1}{k} \sum_{i=1}^k \left( \frac{1}{n_i} \sum_{j=1}^{n_i} x_{ij} \right)
</span></p>
</section>
<section id="section-24" class="slide level2 smaller">
<h2></h2>
<ul>
<li>The <strong>total sum of squares</strong> is</li>
</ul>
<p><span class="math display">
\mathop{\mathrm{TSS}}:= \sum_{i=1}^{k} \sum_{j=1}^{n_i} ( x_{ij} - \overline{x} )^2
</span></p>
<ul>
<li><p><span class="math inline">\mathop{\mathrm{TSS}}</span> measures deviation of samples from the grand mean <span class="math inline">\overline{x}</span></p></li>
<li><p>The <strong>Error Sum of Squares</strong> is</p></li>
</ul>
<p><span class="math display">
\mathop{\mathrm{ESS}}= \sum_{i=1}^k \sum_{j=1}^{n_i} (x_{ij} - \overline{x}_i)^2
</span></p>
<ul>
<li><p>The interior sum of <span class="math inline">\mathop{\mathrm{ESS}}</span> measures the variation within the i-th group</p></li>
<li><p><span class="math inline">\mathop{\mathrm{ESS}}</span> is then a measure of the within-group variability</p></li>
</ul>
</section>
<section id="section-25" class="slide level2 smaller">
<h2></h2>
<ul>
<li>The <strong>Treatment Sum of Squares</strong> is</li>
</ul>
<p><span class="math display">
\mathop{\mathrm{TrSS}}= \sum_{i=1}^{k} n_i ( \overline{x}_i - \overline{x})^2
</span></p>
<ul>
<li><p><span class="math inline">\mathop{\mathrm{TrSS}}</span> compares the means for each group <span class="math inline">\overline{x}_i</span> with the grand mean <span class="math inline">\overline{x}</span></p></li>
<li><p><span class="math inline">\mathop{\mathrm{TrSS}}</span> is then a measure of variability among the groups</p></li>
<li><p>Note: <em>Treatment</em> comes from medical experiments, where the population mean models the effect of some treatment</p></li>
</ul>
<div id="Proposition*-5.1" class="Proposition">
<p></p><details class="Proposition fbx-simplebox fbx-default" open=""><summary><strong>Proposition</strong></summary><div>The following decomposition holds<p></p>
<p><span class="math display">
\mathop{\mathrm{TSS}}= \mathop{\mathrm{ESS}}+ \mathop{\mathrm{TrSS}}
</span></p>
</div></details>
</div>
</section>
<section id="the-anova-f-statistic" class="slide level2 smaller">
<h2>The ANOVA F-statistic</h2>
<div id="Definition*-5.2" class="Definition">
<p></p><details class="Definition fbx-simplebox fbx-default" open=""><summary><strong>Definition</strong></summary><div>The F-statistic for the one-way ANOVA test is<p></p>
<p><span class="math display">
F = \frac{ \mathop{\mathrm{TrSS}}}{ k - 1  } \bigg/
      \frac{ \mathop{\mathrm{ESS}}}{ n - k  }
</span></p>
</div></details>
</div>
<div id="Theorem*-5.3" class="Theorem">
<p></p><details class="Theorem fbx-simplebox fbx-default" open=""><summary><strong>Theorem</strong></summary><div>Assume to have <span class="math inline">k</span> independent, i.i.d samples from <span class="math inline">N(\mu_i,\sigma^2)</span>. Then<p></p>
<p><span class="math display">
F \ \sim \ F_{k-1,n-k}
</span></p>
</div></details>
</div>
</section>
<section id="section-26" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.93em">
<p><span class="math display">\begin{align*}
\text{Case 1: } \, H_0 \, \text{ holds } &amp; \, \iff \,  \text{Population means are all the same}  \\[15pt]
&amp; \, \iff \,  \text{i-th sample mean is similar to grand mean: } \, \overline{x}_i  \approx \overline{x}  \,, \quad \forall\, i\\[15pt]
&amp; \, \iff \, \mathop{\mathrm{TrSS}}= \sum_{i=1}^{k} n_i ( \overline{x}_i - \overline{x})^2 \approx 0  \, \iff \, F = \frac{ \mathop{\mathrm{TrSS}}}{ k - 1  } \bigg/
      \frac{ \mathop{\mathrm{ESS}}}{ n - k  }  \approx 0
\end{align*}</span></p>
<p><span class="math display">\begin{align*}
\text{Case 2: } \, H_1 \, \text{ holds } &amp; \, \iff \,  \text{At least two population means are different}  \\[15pt]
&amp; \, \iff \,  \text{At least two populations satisfy } \, (\overline{x}_i - \overline{x})^2 \gg 0  \\[15pt]
&amp; \, \iff \, \mathop{\mathrm{TrSS}}= \sum_{i=1}^{k} n_i ( \overline{x}_i - \overline{x})^2 \gg 0  \, \iff \, F = \frac{ \mathop{\mathrm{TrSS}}}{ k - 1  } \bigg/
      \frac{ \mathop{\mathrm{ESS}}}{ n - k  }  \gg 0
\end{align*}</span></p>
<p><strong>Therefore, the test is one-sided: <span class="math inline">\,\,</span> Reject <span class="math inline">H_0 \iff F \gg 0</span></strong></p>
</div>
</section>
<section id="the-one-way-anova-f-test" class="slide level2 smaller">
<h2>The one-way ANOVA F-test</h2>
<p>Suppose given k <strong>independent</strong> samples</p>
<ul>
<li>Sample <span class="math inline">x_{i1}, \ldots, x_{in_i}</span> i.i.d from <span class="math inline">N(\mu_i,\sigma^2)</span></li>
</ul>
<p><strong>Goal</strong>: Compare population means <span class="math inline">\mu_i</span></p>
<p><strong>Hypothesis set:</strong> We test for a difference in means</p>
<p><span class="math display">\begin{align*}
H_0 \colon  &amp; \mu_1 = \mu_2 = \ldots = \mu_k \\
H_1 \colon &amp; \mu_i \neq \mu_j \,\, \text{ for at least one pair } \, i \neq j
\end{align*}</span></p>
</section>
<section id="procedure-3-steps" class="slide level2 smaller">
<h2>Procedure: 3 Steps</h2>
<ol type="1">
<li><strong>Calculation</strong>: Compute the samples mean and grand mean <span class="math display">
\overline{x}_i = \frac{1}{n_i} \sum_{j=1}^{n_i} x_{ij} \,, \qquad
\overline{x} = \frac{1}{k} \sum_{i=1}^k  \overline{x}_i  
</span> Compute the <span class="math inline">\mathop{\mathrm{TrSS}}</span> and <span class="math inline">\mathop{\mathrm{ESS}}</span> <span class="math display">
\mathop{\mathrm{TrSS}}= \sum_{i=1}^{k} n_i ( \overline{x}_i - \overline{x})^2 \,, \qquad \mathop{\mathrm{ESS}}= \sum_{i=1}^k \sum_{j=1}^{n_i} (x_{ij} - \overline{x}_i)^2
</span> Compute the F-statistic <span class="math display">
F = \frac{ \mathop{\mathrm{TrSS}}}{ k - 1  } \bigg/
   \frac{ \mathop{\mathrm{ESS}}}{ n - k  }  \  \sim \ F_{k-1,n-k}
</span></li>
</ol>
</section>
<section id="section-27" class="slide level2 smaller">
<h2></h2>
<ol start="2" type="1">
<li><strong>Statistical Tables or R</strong>: Find either
<ul>
<li>Critical value <span class="math inline">F^*</span> in <a href="files/Statistics_Tables.pdf">Table 3</a></li>
<li>p-value in R</li>
</ul></li>
</ol>
<p><br></p>
<ol start="3" type="1">
<li><strong>Interpretation</strong>: Reject <span class="math inline">H_0</span> when either <span class="math display">
p &lt; 0.05 \qquad \text{ or } \qquad F \in \,\,\text{Rejection Region}
</span></li>
</ol>
<table class="caption-top">
<colgroup>
<col style="width: 35%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Alternative</th>
<th>Rejection Region</th>
<th><span class="math inline">F^*</span></th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\exists \,\, i \neq j</span> s.t. <span class="math inline">\mu_i \neq \mu_j</span></td>
<td><span class="math inline">F &gt; F^*</span></td>
<td><span class="math inline">F_{k-1,n-k}(0.05)</span></td>
<td><span class="math inline">P(F_{k-1,n-k} &gt; F)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="worked-example-calorie-consumption" class="slide level2 smaller">
<h2>Worked Example: Calorie Consumption</h2>
<ul>
<li><p>Consider 15 subjects split at random into 3 groups</p></li>
<li><p>Each group is assigned a month</p></li>
<li><p>For each group we record the number of calories consumed on a randomly chosen day</p></li>
<li><p>Assume that calories consumed are normally distributed with common variance, but maybe different means</p></li>
</ul>
<table class="caption-top">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>May</strong></td>
<td style="text-align: left;">2166</td>
<td style="text-align: left;">1568</td>
<td style="text-align: left;">2233</td>
<td style="text-align: left;">1882</td>
<td style="text-align: left;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Sep</strong></td>
<td style="text-align: left;">2279</td>
<td style="text-align: left;">2075</td>
<td style="text-align: left;">2131</td>
<td style="text-align: left;">2009</td>
<td style="text-align: left;">1793</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Dec</strong></td>
<td style="text-align: left;">2226</td>
<td style="text-align: left;">2154</td>
<td style="text-align: left;">2583</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">2190</td>
</tr>
</tbody>
</table>
<p><strong>Question:</strong> Is there a difference in calories consumed each month?</p>
</section>
<section id="boxplot-of-the-data" class="slide level2 smaller">
<h2>Boxplot of the data</h2>
<h3 id="to-visually-compare-sample-means-for-each-population">To visually compare sample means for each population</h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter the data</span></span>
<span id="cb62-2"><a aria-hidden="true" tabindex="-1"></a>may <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2166</span>, <span class="dv">1568</span>, <span class="dv">2233</span>, <span class="dv">1882</span>, <span class="dv">2019</span>)</span>
<span id="cb62-3"><a aria-hidden="true" tabindex="-1"></a>sep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2279</span>, <span class="dv">2075</span>, <span class="dv">2131</span>, <span class="dv">2009</span>, <span class="dv">1793</span>)</span>
<span id="cb62-4"><a aria-hidden="true" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2226</span>, <span class="dv">2154</span>, <span class="dv">2583</span>, <span class="dv">2010</span>, <span class="dv">2190</span>)</span>
<span id="cb62-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Combine vectors into a list and label them</span></span>
<span id="cb62-7"><a aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">May =</span> may, <span class="at">September =</span> sep, <span class="at">December =</span> dec)</span>
<span id="cb62-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Create the boxplot</span></span>
<span id="cb62-10"><a aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(data,</span>
<span id="cb62-11"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Boxplot of Calories Consumed each month"</span>,</span>
<span id="cb62-12"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Daily calories consumed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-28" class="slide level2 smaller">
<h2></h2>

<img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-20-1.png" width="960" class="r-stretch"><ul>
<li><p>It seems that consumption is, on average, higher in colder months</p></li>
<li><p>We suspect population means are different: need one-way ANOVA F-test</p></li>
</ul>
</section>
<section id="performing-the-one-way-anova-f-test" class="slide level2 smaller">
<h2>Performing the one-way ANOVA F-test</h2>
<ul>
<li>We first compute sample means and grand mean <span class="math display">
\overline{x}_i = \frac{1}{n_i} \sum_{j=1}^{n_i} x_{ij} \,, \qquad
\overline{x} = \frac{1}{k} \sum_{i=1}^k  \overline{x}_i  
</span></li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute means for each sample</span></span>
<span id="cb63-2"><a aria-hidden="true" tabindex="-1"></a>may.bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(may)</span>
<span id="cb63-3"><a aria-hidden="true" tabindex="-1"></a>sep.bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(sep)</span>
<span id="cb63-4"><a aria-hidden="true" tabindex="-1"></a>dec.bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(dec)</span>
<span id="cb63-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute grand mean</span></span>
<span id="cb63-8"><a aria-hidden="true" tabindex="-1"></a>x.bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(may, sep, dec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-29" class="slide level2 smaller">
<h2></h2>
<ul>
<li><p>There are 3 groups, each with <span class="math inline">n_i = 5</span> samples</p></li>
<li><p>Compute the <span class="math inline">\mathop{\mathrm{TrSS}}</span> and <span class="math inline">\mathop{\mathrm{ESS}}</span> <span class="math display">
\mathop{\mathrm{TrSS}}= \sum_{i=1}^{k} n_i ( \overline{x}_i - \overline{x})^2 = 5 \sum_{i=1}^{k} ( \overline{x}_i - \overline{x})^2 \,, \qquad \mathop{\mathrm{ESS}}= \sum_{i=1}^k \sum_{j=1}^{n_i} (x_{ij} - \overline{x}_i)^2
</span></p></li>
</ul>
<div style="font-size: 0.92em">
<div class="sourceCode" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute TrSS</span></span>
<span id="cb64-2"><a aria-hidden="true" tabindex="-1"></a>TrSS <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">*</span> ( (may.bar <span class="sc">-</span> x.bar)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (sep.bar <span class="sc">-</span> x.bar)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (dec.bar <span class="sc">-</span> x.bar)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb64-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ESS</span></span>
<span id="cb64-5"><a aria-hidden="true" tabindex="-1"></a>ESS <span class="ot">&lt;-</span> <span class="fu">sum</span>((may <span class="sc">-</span> may.bar)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">sum</span>((sep <span class="sc">-</span> sep.bar)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">sum</span>((dec <span class="sc">-</span> dec.bar)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb64-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print result</span></span>
<span id="cb64-8"><a aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">TrSS =</span> TrSS, <span class="at">ESS =</span> ESS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    TrSS      ESS 
174664.1 586719.6 </code></pre>
</div>
</div>
</section>
<section id="section-30" class="slide level2 smaller">
<h2></h2>
<ul>
<li><p>We have <span class="math inline">k = 3</span> groups; <span class="math inline">\, n = 15</span> total samples</p></li>
<li><p>Compute the F-statistic</p></li>
</ul>
<p><span class="math display">
F = \frac{ \mathop{\mathrm{TrSS}}}{ k - 1  } \bigg/
      \frac{ \mathop{\mathrm{ESS}}}{ n - k  }  \  \sim \ F_{k-1,n-k}
</span></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter number of groups and sample size</span></span>
<span id="cb66-2"><a aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span>; n <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb66-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute F-statistic</span></span>
<span id="cb66-5"><a aria-hidden="true" tabindex="-1"></a>F.obs <span class="ot">=</span> ( TrSS<span class="sc">/</span>(k<span class="dv">-1</span>) ) <span class="sc">/</span> ( ESS<span class="sc">/</span>(n<span class="sc">-</span>k) )</span>
<span id="cb66-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb66-8"><a aria-hidden="true" tabindex="-1"></a>F.obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.786177</code></pre>
</div>
</div>
</section>
<section id="section-31" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Compute the p-value</li>
</ul>
<p><span class="math display">
p = P( F_{k-1,n-k} &gt; F ) = 1 - P( F_{k-1,n-k} \leq F )
</span></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the p-value</span></span>
<span id="cb68-2"><a aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(F.obs, <span class="at">df1 =</span> k<span class="dv">-1</span>, <span class="at">df2 =</span> n<span class="sc">-</span>k)</span>
<span id="cb68-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb68-5"><a aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2093929</code></pre>
</div>
</div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li><p>The p-value is <span class="math inline">p &gt; 0.05 \quad \implies \quad</span> Do not reject <span class="math inline">H_0</span></p></li>
<li><p>No reason to believe that population means are different</p></li>
<li><p>Conclusion: Despite the boxplot, the variation in average monthly calories consumption can be explained by chance only</p></li>
</ul>
<p><strong>Next: Use native R command for ANOVA test - Need Factors</strong></p>
</section></section>
<section>
<section id="part-5-factors-in-r" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 5: <br>Factors in R</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="factors-in-r" class="slide level2 smaller">
<h2>Factors in R</h2>
<ul>
<li><p><strong>Factors:</strong> A way to represent discrete variables taking a finite number of values</p></li>
<li><p><strong>Example:</strong> Suppose to have a vector of peoples names</p></li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a aria-hidden="true" tabindex="-1"></a>firstname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Liz"</span>, <span class="st">"Jolene"</span>, <span class="st">"Susan"</span>, <span class="st">"Boris"</span>, <span class="st">"Rochelle"</span>, <span class="st">"Tim"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Let us store the sex of each person as either
<ul>
<li>Numbers: <span class="math inline">\, \texttt{1}</span> represents female and <span class="math inline">\texttt{0}</span> represents male</li>
<li>Strings: <span class="math inline">\, \texttt{"female"}</span> and <span class="math inline">\texttt{"male"}</span></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a aria-hidden="true" tabindex="-1"></a>sex.num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb71-2"><a aria-hidden="true" tabindex="-1"></a>sex.char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-factor-command" class="slide level2 smaller">
<h2>The factor command</h2>
<ul>
<li>The <span class="math inline">\, \texttt{factor}</span> command turns a vector into a factor</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a aria-hidden="true" tabindex="-1"></a>sex.num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb72-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Turn sex.num into a factor</span></span>
<span id="cb72-4"><a aria-hidden="true" tabindex="-1"></a>sex.num.factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(sex.num)</span>
<span id="cb72-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print the factor obtained</span></span>
<span id="cb72-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sex.num.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 0 1 0
Levels: 0 1</code></pre>
</div>
</div>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<ul>
<li><p>The factor <span class="math inline">\, \texttt{sex.num.factor}</span> looks like the original vector <span class="math inline">\, \texttt{sex.num}</span></p></li>
<li><p>The difference is that the factor <span class="math inline">\, \texttt{sex.num.factor}</span> contains <strong>levels</strong></p>
<ul>
<li>In this case the levels are <span class="math inline">\, \texttt{0}</span> and <span class="math inline">\, \texttt{1}</span></li>
<li>Levels are all the (discrete) values assumed by the vector <span class="math inline">\, \texttt{sex.num}</span></li>
</ul></li>
</ul>
</section>
<section id="the-factor-command-1" class="slide level2 smaller">
<h2>The factor command</h2>
<ul>
<li>In the same way we can convert <span class="math inline">\, \texttt{sex.char}</span> into a factor</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a aria-hidden="true" tabindex="-1"></a>sex.char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>)</span>
<span id="cb74-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Turn sex.char into a factor</span></span>
<span id="cb74-4"><a aria-hidden="true" tabindex="-1"></a>sex.char.factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(sex.char)</span>
<span id="cb74-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print the factor obtained</span></span>
<span id="cb74-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sex.char.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] female female female male   female male  
Levels: female male</code></pre>
</div>
</div>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<ul>
<li><p>Again, the factor <span class="math inline">\, \texttt{sex.char.factor}</span> looks like the original vector <span class="math inline">\, \texttt{sex.char}</span></p></li>
<li><p>Again, the difference is that the factor <span class="math inline">\, \texttt{sex.char.factor}</span> contains <strong>levels</strong></p>
<ul>
<li>In this case the levels are strings <span class="math inline">\, \texttt{"female"}</span> and <span class="math inline">\, \texttt{"male"}</span></li>
<li>These 2 strings are all the values assumed by the vector <span class="math inline">\, \texttt{sex.char}</span></li>
</ul></li>
</ul>
</section>
<section id="reordering-the-levels" class="slide level2 smaller">
<h2>Reordering the Levels</h2>
<ul>
<li>Factor levels are automatically ordered by R
<ul>
<li>Increasing order for numerical factors; Alphabetical order for string factors</li>
</ul></li>
<li>We can manually reorder the factor levels. For example, compare:</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a aria-hidden="true" tabindex="-1"></a>sex.char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>)</span>
<span id="cb76-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Turn sex.char into a factor</span></span>
<span id="cb76-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(sex.char)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] female female female male   female male  
Levels: female male</code></pre>
</div>
</div>
<p><br></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Turn sex.char into a factor, swapping the levels</span></span>
<span id="cb78-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(sex.char, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] female female female male   female male  
Levels: male female</code></pre>
</div>
</div>
</section>
<section id="subsetting-factors" class="slide level2 smaller">
<h2>Subsetting factors</h2>
<ul>
<li>Factors can be subsetted exactly like vectors</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a aria-hidden="true" tabindex="-1"></a>sex.num.factor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 0 1 0
Levels: 0 1</code></pre>
</div>
</div>
<div style="font-size: 0.30em">
<p><br></p>
</div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a aria-hidden="true" tabindex="-1"></a>sex.num.factor[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 0 1
Levels: 0 1</code></pre>
</div>
</div>
</section>
<section id="subsetting-factors-1" class="slide level2 smaller">
<h2>Subsetting factors</h2>
<ul>
<li><strong>Warning:</strong> After subsetting a factor, all defined levels are still stored
<ul>
<li>This is true even if some of the levels are no longer represented in the subsetted factor</li>
</ul></li>
</ul>
<div style="font-size: 0.30em">
<p><br></p>
</div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a aria-hidden="true" tabindex="-1"></a>sex.char.factor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] female female female male   female male  
Levels: female male</code></pre>
</div>
</div>
<div style="font-size: 0.30em">
<p><br></p>
</div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a aria-hidden="true" tabindex="-1"></a>sex.char.factor[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] female female female female
Levels: female male</code></pre>
</div>
</div>
<div style="font-size: 0.30em">
<p><br></p>
</div>
<ul>
<li><p>The levels of <code>sex.char.factor[c(1:3, 5)]</code> are still <span class="math inline">\, \texttt{"female"}</span> and <span class="math inline">\, \texttt{"male"}</span></p></li>
<li><p>This is despite <code>sex.char.factor[c(1:3, 5)]</code> only containing <span class="math inline">\, \texttt{"female"}</span></p></li>
</ul>
</section>
<section id="the-levels-function" class="slide level2 smaller">
<h2>The levels function</h2>
<ul>
<li>The levels of a factor can be extracted with the function <span class="math inline">\, \texttt{levels}</span></li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sex.char.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female" "male"  </code></pre>
</div>
</div>
<div style="font-size: 0.30em">
<p><br></p>
</div>
<ul>
<li><strong>Note:</strong> Levels of a factor are always stored as <strong>strings</strong>, even if originally numbers</li>
</ul>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sex.num.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "0" "1"</code></pre>
</div>
</div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li><p>The levels of <span class="math inline">\, \texttt{sex.num.factor}</span> are the strings <span class="math inline">\, \texttt{"0"}</span> and <span class="math inline">\, \texttt{"1"}</span></p></li>
<li><p>This is despite the original vector <span class="math inline">\, \texttt{sex.num}</span> being numeric</p></li>
<li><p>The command <span class="math inline">\, \texttt{factor}</span> converted numeric levels into strings</p></li>
</ul>
</section>
<section id="relabelling-a-factor" class="slide level2 smaller">
<h2>Relabelling a factor</h2>
<ul>
<li><p>The function <span class="math inline">\, \texttt{levels}</span> can also be used to <strong>relabel</strong> factors</p></li>
<li><p>For example we can relabel</p>
<ul>
<li><span class="math inline">\, \texttt{female}</span> into <span class="math inline">\, \texttt{f}</span></li>
<li><span class="math inline">\, \texttt{male}</span> into <span class="math inline">\, \texttt{m}</span></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Relabel levels of sex.char.factor</span></span>
<span id="cb92-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sex.char.factor) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>)</span>
<span id="cb92-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print relabelled factor</span></span>
<span id="cb92-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sex.char.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] f f f m f m
Levels: f m</code></pre>
</div>
</div>
</section>
<section id="logical-subsetting-of-factors" class="slide level2 smaller">
<h2>Logical subsetting of factors</h2>
<ul>
<li><p>Logical subsetting is done exactly like in the case of vectors</p></li>
<li><p><strong>Important:</strong> Need to remember that levels are always <strong>strings</strong></p></li>
<li><p><strong>Example:</strong> To identify all the men in <span class="math inline">\, \texttt{sex.num.factor}</span> we do</p></li>
</ul>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a aria-hidden="true" tabindex="-1"></a>sex.num.factor <span class="sc">==</span> <span class="st">"0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE  TRUE FALSE  TRUE</code></pre>
</div>
</div>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<ul>
<li>To retrieve names of men stored in <span class="math inline">\, \texttt{firstname}</span> use logical subsetting</li>
</ul>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a aria-hidden="true" tabindex="-1"></a>firstname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Liz"</span>, <span class="st">"Jolene"</span>, <span class="st">"Susan"</span>, <span class="st">"Boris"</span>, <span class="st">"Rochelle"</span>, <span class="st">"Tim"</span>)</span>
<span id="cb96-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a aria-hidden="true" tabindex="-1"></a>firstname[ sex.num.factor <span class="sc">==</span> <span class="st">"0"</span> ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Boris" "Tim"  </code></pre>
</div>
</div>
</section></section>
<section>
<section id="part-6-anova-with-aov" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 6: <br>ANOVA with aov</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="anova-with-aov" class="slide level2 smaller">
<h2>Anova with aov</h2>
<ul>
<li>We have conducted the one-way ANOVA F-test by hand
<ul>
<li>This is cumbersome with large datasets with many populations</li>
<li>The quick way in R is to use the command <code>aov</code> (<em>analysis of variance</em>)</li>
</ul></li>
</ul>
</section>
<section id="method" class="slide level2 smaller">
<h2>Method</h2>
<ul>
<li><p>Place all the samples into one long vector <code>values</code></p></li>
<li><p>Create a vector with corresponding group labels <code>ind</code></p></li>
<li><p>Turn <code>ind</code> into a factor</p></li>
<li><p>Combine <code>values</code> and <code>ind</code> into a dataframe <code>d</code></p></li>
<li><p>Therefore, dataframe <code>d</code> contains:</p>
<ul>
<li>First Column: <em>values</em> for each sample</li>
<li>Second Column: <em>ind</em>, indicating the group the corresponding sample is from</li>
</ul></li>
<li><p>The ANOVA F-test is performed with</p></li>
</ul>
<p><span class="math display">
\text{aov(values } \sim \text{ ind, data = d)}
</span></p>
<ul>
<li><code>values ~ ind</code> is the formula coupling values to the corresponding group</li>
</ul>
</section>
<section id="example-1-calorie-consumption" class="slide level2 smaller">
<h2>Example 1: Calorie Consumption</h2>
<ul>
<li><p>Recall: we have 15 subjects split at random into 3 groups</p></li>
<li><p>Each group is assigned a month</p></li>
<li><p>For each group we record the number of calories consumed on a randomly chosen day</p></li>
<li><p>Assume that calories consumed are normally distributed with common variance, but maybe different means</p></li>
</ul>
<table class="caption-top">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>May</strong></td>
<td style="text-align: left;">2166</td>
<td style="text-align: left;">1568</td>
<td style="text-align: left;">2233</td>
<td style="text-align: left;">1882</td>
<td style="text-align: left;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Sep</strong></td>
<td style="text-align: left;">2279</td>
<td style="text-align: left;">2075</td>
<td style="text-align: left;">2131</td>
<td style="text-align: left;">2009</td>
<td style="text-align: left;">1793</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Dec</strong></td>
<td style="text-align: left;">2226</td>
<td style="text-align: left;">2154</td>
<td style="text-align: left;">2583</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">2190</td>
</tr>
</tbody>
</table>
<p><strong>Question:</strong> Is there a difference in calories consumed each month?</p>
</section>
<section id="preparing-the-data" class="slide level2 smaller">
<h2>Preparing the data</h2>
<div style="font-size: 0.86em">
<div class="columns">
<div class="column" style="width:60%;">
<div class="sourceCode" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter the data</span></span>
<span id="cb98-2"><a aria-hidden="true" tabindex="-1"></a>may <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2166</span>, <span class="dv">1568</span>, <span class="dv">2233</span>, <span class="dv">1882</span>, <span class="dv">2019</span>)</span>
<span id="cb98-3"><a aria-hidden="true" tabindex="-1"></a>sep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2279</span>, <span class="dv">2075</span>, <span class="dv">2131</span>, <span class="dv">2009</span>, <span class="dv">1793</span>)</span>
<span id="cb98-4"><a aria-hidden="true" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2226</span>, <span class="dv">2154</span>, <span class="dv">2583</span>, <span class="dv">2010</span>, <span class="dv">2190</span>)</span>
<span id="cb98-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Combine values into one long vector</span></span>
<span id="cb98-7"><a aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(may, sep, dec)</span>
<span id="cb98-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Create vector of group labels</span></span>
<span id="cb98-10"><a aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"May"</span>, <span class="st">"Sep"</span>, <span class="st">"Dec"</span>), <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb98-11"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-12"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Turn vector of group labels into a factor</span></span>
<span id="cb98-13"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Note that we order the levels</span></span>
<span id="cb98-14"><a aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">factor</span>(ind, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"May"</span>, <span class="st">"Sep"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb98-15"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-16"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Combine values and labels into a data frame</span></span>
<span id="cb98-17"><a aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(values, ind)</span>
<span id="cb98-18"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-19"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print d for visualization</span></span>
<span id="cb98-20"><a aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   values ind
1    2166 May
2    1568 May
3    2233 May
4    1882 May
5    2019 May
6    2279 Sep
7    2075 Sep
8    2131 Sep
9    2009 Sep
10   1793 Sep
11   2226 Dec
12   2154 Dec
13   2583 Dec
14   2010 Dec
15   2190 Dec</code></pre>
</div>
</div>
</div></div>
</div>
</section>
<section id="boxplot-of-the-data-1" class="slide level2 smaller">
<h2>Boxplot of the data</h2>
<ul>
<li><p>Previously, we constructed a boxplot by placing the data into a list</p></li>
<li><p>Now that we have a dataframe, the commands are much simpler:</p>
<ul>
<li>Pass the dataframe <code>d</code> to <code>boxplot</code></li>
<li>Pass the formula <code>values ~ ind</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(values <span class="sc">~</span> ind, <span class="at">data =</span> d,</span>
<span id="cb100-2"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Boxplot of Calories Consumed each month"</span>,</span>
<span id="cb100-3"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Daily calories consumed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-32" class="slide level2 smaller">
<h2></h2>

<img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-38-1.png" width="960" class="r-stretch"><ul>
<li><p>Already observed: Consumption is, on average, higher in colder months</p></li>
<li><p>We suspect population means are different: need one-way ANOVA F-test</p></li>
<li><p>We have already conducted the test by hand. We now use <code>aov</code></p></li>
</ul>
</section>
<section id="calling-aov" class="slide level2 smaller">
<h2>Calling aov</h2>
<ul>
<li>Data is stored in dataframe <code>d</code>
<ul>
<li>1st column <code>values</code> contains calories consumed</li>
<li>2nd column <code>ind</code> contains month labels</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Perform ANOVA F-test for difference in means</span></span>
<span id="cb101-2"><a aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">aov</span>(values <span class="sc">~</span> ind, <span class="at">data =</span> d)</span>
<span id="cb101-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb101-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)
ind          2 174664   87332   1.786  0.209
Residuals   12 586720   48893               </code></pre>
</div>
</div>
<ul>
<li><p>As obtained with hand calculation, the p-value is <span class="math inline">p = 0.209</span></p></li>
<li><p><span class="math inline">p &gt; 0.05 \implies</span> Do not reject <span class="math inline">H_0</span>: Population means are similar</p></li>
</ul>
</section>
<section id="example-2-anova-vs-two-sample-t-test" class="slide level2 smaller">
<h2>Example 2: ANOVA vs Two-sample t-test</h2>
<p>When only 2 groups are present, they coincide:</p>
<ul>
<li><p>ANOVA F-test for difference in means</p></li>
<li><p>Two-sample t-test for difference in means<br>
(with assumption of equal variance)</p></li>
</ul>
<p><strong>Example:</strong> Let us compare calories data only for the months of May and Dec</p>
<p><br></p>
<table class="caption-top">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>May</strong></td>
<td style="text-align: left;">2166</td>
<td style="text-align: left;">1568</td>
<td style="text-align: left;">2233</td>
<td style="text-align: left;">1882</td>
<td style="text-align: left;">2019</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dec</strong></td>
<td style="text-align: left;">2226</td>
<td style="text-align: left;">2154</td>
<td style="text-align: left;">2583</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">2190</td>
</tr>
</tbody>
</table>
</section>
<section id="section-33" class="slide level2 smaller">
<h2></h2>
<ul>
<li>First, let us conduct a two-sample t-test for difference in means</li>
</ul>
<div class="sourceCode" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Enter the data</span></span>
<span id="cb103-2"><a aria-hidden="true" tabindex="-1"></a>may <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2166</span>, <span class="dv">1568</span>, <span class="dv">2233</span>, <span class="dv">1882</span>, <span class="dv">2019</span>)</span>
<span id="cb103-3"><a aria-hidden="true" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2226</span>, <span class="dv">2154</span>, <span class="dv">2583</span>, <span class="dv">2010</span>, <span class="dv">2190</span>)</span>
<span id="cb103-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Two-sample t-test for difference in means</span></span>
<span id="cb103-6"><a aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(may, dec, <span class="at">var.equal =</span> T)<span class="sc">$</span>p.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1259272</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><p>The p-value is <span class="math inline">p \approx 0.126</span></p></li>
<li><p>Since <span class="math inline">p &gt; 0.05</span>, we do not reject <span class="math inline">H_0</span></p></li>
<li><p>In particular, we conclude that populations means are similar:</p>
<ul>
<li>Calories consumed in May and December do not differ on average</li>
</ul></li>
</ul>
</section>
<section id="section-34" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.92em">
<ul>
<li>Let us now compare the two population means with the ANOVA F-test</li>
</ul>
<div class="sourceCode" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Combine values into one long vector</span></span>
<span id="cb105-2"><a aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(may, dec)</span>
<span id="cb105-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Create factor of group labels</span></span>
<span id="cb105-5"><a aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"May"</span>, <span class="st">"Dec"</span>), <span class="at">each =</span> <span class="dv">5</span>))</span>
<span id="cb105-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Combine values and labels into a data frame</span></span>
<span id="cb105-8"><a aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(values, ind)</span>
<span id="cb105-9"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-10"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Perform ANOVA F-test</span></span>
<span id="cb105-11"><a aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">aov</span>(values <span class="sc">~</span> ind, <span class="at">data =</span> d)</span>
<span id="cb105-12"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb105-14"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)
ind          1 167702  167702   2.919  0.126
Residuals    8 459636   57455               </code></pre>
</div>
</div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li><p>The p-values <span class="math inline">p \approx 0.126</span> coincide! ANOVA F-test and Two-sample t-test are equivalent</p></li>
<li><p>This fact is discussed in details in the next 2 Parts</p></li>
</ul>
</div>
</section></section>
<section>
<section id="part-7-dummy-variable-regression" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 7: <br>Dummy variable <br> Regression</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="explaining-the-terminology" class="slide level2 smaller">
<h2>Explaining the terminology</h2>
<ul>
<li><p><strong>Dummy variable:</strong> Variables <span class="math inline">X</span> which are qualitative in nature</p></li>
<li><p><strong>ANOVA:</strong> refers to situations where regression models contain</p>
<ul>
<li><strong>only</strong> dummy variables <span class="math inline">X</span></li>
<li>This generalizes the ANOVA F-test seen earlier</li>
</ul></li>
<li><p><strong>ANCOVA:</strong> refers to situations where regression models contain a combination of</p>
<ul>
<li>dummy variables <strong>and</strong> quantitative (the usual) variables</li>
</ul></li>
</ul>
</section>
<section id="dummy-variables" class="slide level2 smaller">
<h2>Dummy variables</h2>
<ul>
<li><p><strong>Dummy variable:</strong></p>
<ul>
<li>A variable <span class="math inline">X</span> which is qualitative in nature</li>
<li>Often called <strong>cathegorical variables</strong></li>
</ul></li>
<li><p>Regression models can include dummy variables</p></li>
<li><p>Qualitatitve <strong>binary</strong> variables can be represented by <span class="math inline">X</span> with</p>
<ul>
<li><span class="math inline">X = 1 \,</span> if effect present</li>
<li><span class="math inline">X = 0 \,</span> if effect not present</li>
</ul></li>
<li><p>Examples of <strong>binary</strong> quantitative variables are</p>
<ul>
<li>On / Off</li>
<li>Yes / No</li>
<li>Sample is from Population A / B</li>
</ul></li>
</ul>
</section>
<section id="dummy-variables-1" class="slide level2 smaller">
<h2>Dummy variables</h2>
<ul>
<li>Dummy variables can also take several values
<ul>
<li>These values are often called <strong>levels</strong></li>
<li>Such variables are represented by <span class="math inline">X</span> taking discrete values</li>
</ul></li>
<li>Examples of dummy variables with several levels
<ul>
<li>Month: Jan, Feb, Mar, </li>
<li>Season: Summer, Autumn, Winter, Spring</li>
<li>Priority: Low, Medium, High</li>
<li>Quarterly sales data: Q1, Q2, Q3, Q4</li>
<li>UK regions: East Midlands, London Essex, North East/Yorkshire, </li>
</ul></li>
</ul>
</section>
<section id="example-fridge-sales-data" class="slide level2 smaller">
<h2>Example: Fridge sales data</h2>
<div style="font-size: 0.90em">
<ul>
<li>Consider the dataset on quarterly fridge sales <a href="datasets/fridge_sales.txt">fridge_sales.txt</a>
<ul>
<li>Each entry represents sales data for 1 quarter</li>
<li>4 consecutive entries represent sales data for 1 year</li>
</ul></li>
</ul>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   fridge.sales durable.goods.sales q1 q2 q3 q4 quarter
1          1317               252.6  1  0  0  0       1
2          1615               272.4  0  1  0  0       2
3          1662               270.9  0  0  1  0       3
4          1295               273.9  0  0  0  1       4
5          1271               268.9  1  0  0  0       1
6          1555               262.9  0  1  0  0       2
7          1639               270.9  0  0  1  0       3
8          1238               263.4  0  0  0  1       4
9          1277               260.6  1  0  0  0       1
10         1258               231.9  0  1  0  0       2
11         1417               242.7  0  0  1  0       3
12         1185               248.6  0  0  0  1       4
13         1196               258.7  1  0  0  0       1
14         1410               248.4  0  1  0  0       2
15         1417               255.5  0  0  1  0       3
16          919               240.4  0  0  0  1       4
17          943               247.7  1  0  0  0       1
18         1175               249.1  0  1  0  0       2
19         1269               251.8  0  0  1  0       3
20          973               262.0  0  0  0  1       4
21         1102               263.3  1  0  0  0       1
22         1344               280.0  0  1  0  0       2
23         1641               288.5  0  0  1  0       3
24         1225               300.5  0  0  0  1       4
25         1429               312.6  1  0  0  0       1
26         1699               322.5  0  1  0  0       2
27         1749               324.3  0  0  1  0       3
28         1117               333.1  0  0  0  1       4
29         1242               344.8  1  0  0  0       1
30         1684               350.3  0  1  0  0       2
31         1764               369.1  0  0  1  0       3
32         1328               356.4  0  0  0  1       4</code></pre>
</div>
</div>
</div>
</section>
<section id="section-35" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.90em">
<ul>
<li>Below are the first 4 entries of the <em>Fridge sales dataset</em>
<ul>
<li>These correspond to 1 year of sales data</li>
</ul></li>
<li>First two variables are quantitative
<ul>
<li><em>Fridge Sales</em> <span class="math inline">=</span> total quarterly fridge sales (in million $)</li>
<li><em>Duarable Goods Sales</em> <span class="math inline">=</span> total quarterly durable goods sales (in billion $)</li>
</ul></li>
<li>Remaining variables are qualitative:
<ul>
<li><em>Q1</em>, <em>Q2</em>, <em>Q3</em>, <em>Q4</em> <span class="math inline">\,</span> take values 0 / 1 <span class="math inline">\quad</span> (representing 4 yearly quarters)</li>
<li><em>Quarter</em> <span class="math inline">\,</span> takes values 1 / 2 / 3 / 4 <span class="math inline">\quad</span> (equivalent representation of quarters)</li>
</ul></li>
</ul>
<div style="font-size: 0.40em">
<p><br></p>
</div>
<table class="caption-top">
<thead>
<tr class="header">
<th>Fridge Sales</th>
<th>Durable Goods Sales</th>
<th>Q1</th>
<th>Q2</th>
<th>Q3</th>
<th>Q4</th>
<th>Quarter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1317</td>
<td>252.6</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>1615</td>
<td>272.4</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1662</td>
<td>270.9</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="even">
<td>1295</td>
<td>273.9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="encoding-quarter-in-regression-model" class="slide level2 smaller">
<h2>Encoding Quarter in regression model</h2>
<p><strong>Two alternative approaches:</strong></p>
<ol type="1">
<li>Include <span class="math inline">4-1 = 3</span> dummy variables with values 0 / 1
<ul>
<li>Each dummy variable represents 1 Quarter</li>
<li>We need 3 variables to represent 4 Quarters (plus the intercept)</li>
</ul></li>
<li>Include one variable which takes values 1 / 2 / 3 / 4</li>
</ol>
<p><strong>Differences between the two approaches:</strong></p>
<ol type="1">
<li><p>This method works with command <code>lm</code></p></li>
<li><p>This method works with the command <code>aov</code></p></li>
</ol>
</section>
<section id="the-dummy-variable-trap" class="slide level2 smaller">
<h2>The dummy variable trap</h2>
<ul>
<li>Suppose you follow the first approach:
<ul>
<li>Encode each quarter with a separate variable</li>
</ul></li>
<li>If you have 4 different levels, you would need
<ul>
<li><span class="math inline">4-1=3</span> dummy variables</li>
<li>the intercept term</li>
</ul></li>
<li>In general: if you have <span class="math inline">k</span> different levels, you would need
<ul>
<li><span class="math inline">k-1</span> dummy variables</li>
<li>the intercept term</li>
</ul></li>
</ul>
<p><strong>Question:</strong> Why only <span class="math inline">k - 1</span> dummy variables?</p>
<p><strong>Answer:</strong> To avoid the <strong>dummy variable trap</strong></p>
</section>
<section id="example-dummy-variable-trap" class="slide level2 smaller">
<h2>Example: Dummy variable trap</h2>
<p>To illustrate the dummy variable trap, consider the following</p>
<ul>
<li>Encode each Quarter with one dummy variable <span class="math inline">\mathbf{1}_i</span></li>
</ul>
<p><span class="math display">
\mathbf{1}_j(i) = \begin{cases}
1 &amp; \text{ if sample i belongs to Quarter j} \\
0 &amp; \text{ otherwise} \\
\end{cases}
</span></p>
<ul>
<li>Consider the regression model with intercept</li>
</ul>
<p><span class="math display">
Y = \beta_0 \cdot (1) + \beta_1 \mathbf{1}_1 + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4   + \varepsilon
</span></p>
<ul>
<li>In the above, <span class="math inline">Y</span> is the quartely <em>Fridge sales data</em></li>
</ul>
</section>
<section id="section-36" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Each data entry belongs to exactly one Quarter. Thus</li>
</ul>
<p><span class="math display">
\mathbf{1}_1 + \mathbf{1}_2 + \mathbf{1}_3 + \mathbf{1}_4 = 1
</span></p>
<ul>
<li><p><strong>Dummy variable trap:</strong> Variables are collinear (linearly dependent)</p></li>
<li><p>Indeed the design matrix is</p></li>
</ul>
<p><span class="math display">
Z =
\left(
\begin{array}{ccccc}
1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
\dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots \\
\end{array}
\right)
</span></p>
<ul>
<li>First column is the sum of remaining columns <span class="math inline">\quad \implies \quad</span> Multicollinearity</li>
</ul>
</section>
<section id="example-avoiding-dummy-variable-trap" class="slide level2 smaller">
<h2>Example: Avoiding dummy variable trap</h2>
<ul>
<li><p>We want to avoid Multicollinearity (or dummy variable trap)</p></li>
<li><p><strong>How?</strong> Drop one dummy variable (e.g.&nbsp;the first) and consider the model</p></li>
</ul>
<p><span class="math display">
Y = \beta_1 \cdot (1) + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4  + \varepsilon
</span></p>
<ul>
<li><p>If data belongs to Q1, then <span class="math inline">\mathbf{1}_2 = \mathbf{1}_3 = \mathbf{1}_4 = 0</span></p></li>
<li><p>Therefore, in general, we have</p></li>
</ul>
<p><span class="math display">
\mathbf{1}_2 + \mathbf{1}_3 + \mathbf{1}_4 \not\equiv 1
</span></p>
<ul>
<li>This way we <strong>avoid</strong> Multicollinearity <span class="math inline">\quad \implies \quad</span> <strong>no trap!</strong></li>
</ul>
</section>
<section id="section-37" class="slide level2 smaller">
<h2></h2>
<ul>
<li><strong>Question:</strong> How do we interpret the coefficients in the model</li>
</ul>
<p><span class="math display">
Y = \beta_1 \cdot (1)  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4  + \varepsilon\qquad ?
</span></p>
<ul>
<li><strong>Answer:</strong> Recall the relationship</li>
</ul>
<p><span class="math display">
\mathbf{1}_1 + \mathbf{1}_2 + \mathbf{1}_3 + \mathbf{1}_4 = 1
</span></p>
<ul>
<li>Substituting in the regression model we get</li>
</ul>
<p><span class="math display">\begin{align*}
Y &amp; = \beta_1 \cdot ( \mathbf{1}_1 + \mathbf{1}_2 + \mathbf{1}_3 + \mathbf{1}_4 ) + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4  + \varepsilon\\[10pts]
&amp; = \beta_1 \mathbf{1}_1 + (\beta_1 + \beta_2) \mathbf{1}_2 + (\beta_1 + \beta_3) \mathbf{1}_3 + (\beta_1 + \beta_4 ) \mathbf{1}_4 + \varepsilon
\end{align*}</span></p>
</section>
<section id="section-38" class="slide level2 smaller">
<h2></h2>
<p>Therefore, the regression coefficients are such that</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Group</th>
<th>Increase Described By</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\mathbf{1}_1</span></td>
<td><span class="math inline">\beta_1</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\mathbf{1}_2</span></td>
<td><span class="math inline">\beta_1 + \beta_2</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\mathbf{1}_3</span></td>
<td><span class="math inline">\beta_1 + \beta_3</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\mathbf{1}_4</span></td>
<td><span class="math inline">\beta_1 + \beta_4</span></td>
</tr>
</tbody>
</table>
<p><strong>Conclusion:</strong> When fitting regression model with dummy variables</p>
<ul>
<li><p>Increase for first dummy variable <span class="math inline">\mathbf{1}_1</span> is intercept term <span class="math inline">\beta_1</span></p></li>
<li><p>Increase for successive dummy variables <span class="math inline">\mathbf{1}_i</span> with <span class="math inline">i &gt; 1</span> is computed by <span class="math inline">\beta_1 + \beta_i</span></p></li>
</ul>
<p><strong>Intercept coefficient acts as base reference point</strong></p>
</section>
<section id="general-case-dummy-variable-trap" class="slide level2 smaller">
<h2>General case: Dummy variable trap</h2>
<ul>
<li>Suppose to have a qualitative variable <span class="math inline">X</span> which takes <span class="math inline">k</span> different levels
<ul>
<li>E.g. the previous example has <span class="math inline">k = 4</span> quarters</li>
</ul></li>
<li>Encode each level of <span class="math inline">X</span> in one dummy variable <span class="math inline">\mathbf{1}_j</span></li>
</ul>
<p><span class="math display">
\mathbf{1}_j(i) = \begin{cases}
1 &amp; \text{ if } X(i) = j \\
0 &amp; \text{ otherwise} \\
\end{cases}
</span></p>
<ul>
<li>To each data entry corresponds one and only one level of <span class="math inline">X</span>, so that</li>
</ul>
<p><span class="math display">
\mathbf{1}_1 + \mathbf{1}_2 + \ldots + \mathbf{1}_k = 1
</span></p>
<ul>
<li>Hence <strong>Multicollinearity</strong> if intercept is present <span class="math inline">\, \implies \,</span> <strong>Dummy variable trap!</strong></li>
</ul>
</section>
<section id="general-case-avoid-the-trap" class="slide level2 smaller">
<h2>General case: Avoid the trap!</h2>
<ul>
<li>We drop the first dummy variable <span class="math inline">\mathbf{1}_1</span> and consider the model</li>
</ul>
<p><span class="math display">
Y = \beta_1 \cdot (1)  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \ldots + \beta_k \mathbf{1}_k  + \varepsilon
</span></p>
<ul>
<li>For data points such that <span class="math inline">X = 1</span>, we have</li>
</ul>
<p><span class="math display">
\mathbf{1}_2 = \mathbf{1}_3 = \ldots = \mathbf{1}_k = 0
</span></p>
<ul>
<li>Therefore, in general, we get</li>
</ul>
<p><span class="math display">
\mathbf{1}_2 + \mathbf{1}_3 + \ldots + \mathbf{1}_k \not \equiv 1
</span></p>
<ul>
<li>This way we avoid Multicollinearity <span class="math inline">\quad \implies \quad</span> <strong>no trap!</strong></li>
</ul>
</section>
<section id="general-case-interpret-the-output" class="slide level2 smaller">
<h2>General case: Interpret the output</h2>
<ul>
<li>How to interpret the coefficients in the model</li>
</ul>
<p><span class="math display">
Y = \beta_1 \cdot (1)  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \ldots + \beta_k \mathbf{1}_k  + \varepsilon\quad ?
</span></p>
<ul>
<li>We can argue similarly to the case <span class="math inline">m = 4</span> and use the constraint</li>
</ul>
<p><span class="math display">
\mathbf{1}_1 + \mathbf{1}_2 + \ldots + \mathbf{1}_k = 1
</span></p>
<ul>
<li>Substituting in the regression model we get</li>
</ul>
<p><span class="math display">
Y = \beta_1 \mathbf{1}_1 + (\beta_1 + \beta_2) \mathbf{1}_2 + \ldots + (\beta_1 + \beta_k) \mathbf{1}_k + \varepsilon
</span></p>
</section>
<section id="section-39" class="slide level2 smaller">
<h2></h2>
<p><strong>Conclusion:</strong> When fitting regression model with dummy variables</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Group</th>
<th>Increase Described By</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\mathbf{1}_1</span></td>
<td><span class="math inline">\beta_1</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\mathbf{1}_i</span></td>
<td><span class="math inline">\beta_1 + \beta_i</span></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Increase for first dummy variable <span class="math inline">\mathbf{1}_1</span> is intercept term <span class="math inline">\beta_1</span></p></li>
<li><p>Increase for successive dummy variables <span class="math inline">\mathbf{1}_i</span> with <span class="math inline">i &gt; 1</span> is computed by <span class="math inline">\beta_1 + \beta_i</span></p></li>
</ul>
<p><strong>Intercept coefficient acts as base reference point</strong></p>
</section></section>
<section>
<section id="part-8-anova-as-regression" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 8: <br> ANOVA as Regression</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="anova-f-test-and-regression" class="slide level2 smaller">
<h2>ANOVA F-test and regression</h2>
<ul>
<li><p>ANOVA can be seen as linear regression problem, by using <em>dummy variables</em></p></li>
<li><p>In particular, we will show that</p>
<ul>
<li><strong>ANOVA F-test is equivalent to F-test for overall significance</strong></li>
</ul></li>
</ul>
<div style="font-size: 0.2em">
<p><br></p>
</div>
<ul>
<li>We have already seen a particular instance of this fact in the Homework
<ul>
<li><strong>Simple linear regression can be used to perform two-sample t-test</strong><br>
(recall that two-sample t-test is just the ANOVA F-test with two populations)</li>
</ul></li>
</ul>
<div style="font-size: 0.2em">
<p><br></p>
</div>
<ul>
<li>This was done by considering the model</li>
</ul>
<p><span class="math display">
Y_i = \beta_1 + \beta_2 \, \mathbf{1}_2 (i) + \varepsilon_i
</span></p>
</section>
<section id="simple-regression-for-two-sample-t-test" class="slide level2 smaller">
<h2>Simple regression for two-sample t-test</h2>
<ul>
<li><p>Assume given two independent normal populations <span class="math inline">N(\mu_1, \sigma^2)</span> and <span class="math inline">N(\mu_2, \sigma^2)</span></p></li>
<li><p>We have two samples</p>
<ul>
<li>Sample of size <span class="math inline">n_1</span> iid from population <span class="math inline">1</span> <span class="math display">
a = (a_1, \ldots, a_{n_1})
</span></li>
<li>Sample of size <span class="math inline">n_2</span> iid from population <span class="math inline">2</span> <span class="math display">
b = (b_1, \ldots, b_{n_2})
</span></li>
</ul></li>
<li><p>The data vector <span class="math inline">y</span> is obtained by concatenating <span class="math inline">a</span> and <span class="math inline">b</span></p></li>
</ul>
<p><span class="math display">
y = (a,b) = (a_1, \ldots, a_{n_1}, b_1, \ldots, b_{n_2} )
</span></p>
</section>
<section id="section-40" class="slide level2 smaller">
<h2></h2>
<ul>
<li>We then considered the dummy variable model</li>
</ul>
<p><span class="math display">
Y_i = \beta_1 + \beta_2 \, \mathbf{1}_2 (i) + \varepsilon_i
</span></p>
<ul>
<li>Here <span class="math inline">\mathbf{1}_2 (i)</span> is the dummy variable relative to population <span class="math inline">B</span></li>
</ul>
<p><span class="math display">
\mathbf{1}_2(i) = \begin{cases}
1 &amp; \text{ if i-th sample belongs to population 2} \\
0 &amp; \text{ otherwise}
\end{cases}
</span></p>
<ul>
<li>The regression function is therefore</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = x] = \beta_1 + \beta_2 x
</span></p>
</section>
<section id="section-41" class="slide level2 smaller">
<h2></h2>
<ul>
<li>By construction, we have that</li>
</ul>
<p><span class="math display">
Y | \text{sample belongs to population 1}  \ \sim \ N(\mu_1, \sigma^2)
</span></p>
<ul>
<li>Therefore, by definition of <span class="math inline">\mathbf{1}_2</span>, we get</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = 0] = {\rm I\kern-.3em E}[Y | \text{ sample belongs to population 1}] = \mu_1
</span></p>
<ul>
<li>On the other hand, the regression function is</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = x] = \beta_1 + \beta_2 x
</span></p>
<ul>
<li>Thus</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = 0] = \beta_1 + \beta_2 \cdot 0 = \beta_1
\qquad \implies \qquad \beta_1 = \mu_1
</span></p>
</section>
<section id="section-42" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Similarly, by construction, we have that</li>
</ul>
<p><span class="math display">
Y | \text{sample belongs to population 2}  \ \sim \ N(\mu_2, \sigma^2)
</span></p>
<ul>
<li>Therefore, by definition of <span class="math inline">\mathbf{1}_2</span>, we get</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = 1] = {\rm I\kern-.3em E}[Y | \text{ sample belongs to population 2}] = \mu_2
</span></p>
<ul>
<li>On the other hand, the regression function is</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = x] = \beta_1 + \beta_2 x
</span></p>
<ul>
<li>Thus</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_2 = 1] = \beta_1 + \beta_2
\qquad \implies \qquad \beta_1 + \beta_2 = \mu_2
</span></p>
</section>
<section id="section-43" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.93em">
<ul>
<li>Therefore, we have proven</li>
</ul>
<p><span class="math display">
\beta_1 = \mu_1 \,, \qquad \beta_1 + \beta_2 = \mu_2 \qquad \implies \qquad \beta_2 = \mu_2 - \mu_1
</span></p>
<ul>
<li>Recall the the regression model is</li>
</ul>
<p><span class="math display">
Y_i = \beta_1 + \beta_2  \, \mathbf{1}_{2} (i) + \varepsilon_i
</span></p>
<ul>
<li>The hypothesis for F-test for Overall Significance for above model is</li>
</ul>
<p><span class="math display">
H_0 \colon \beta_2 = 0 \,, \qquad H_1 \colon \beta_2 \neq 0
</span></p>
<ul>
<li><p>Since <span class="math inline">\beta_2 = \mu_2 - \mu_1</span>, the above hypothesis is equivalent to <span class="math display">
H_0 \colon \mu_1 = \mu_2 \,, \qquad  H_1 \colon \mu_1 \neq \mu_2
</span></p></li>
<li><p><strong>Hypotheses for F-test of Overall Significance and two-sample t-test are equivalent</strong></p></li>
</ul>
</div>
</section>
<section id="section-44" class="slide level2 smaller">
<h2></h2>
<ul>
<li><p>In the Homework, we have also proven that the ML estimators for the model <span class="math display">
Y_i = \beta_1 + \beta_2  \, \mathbf{1}_{2} (i) + \varepsilon_i
</span> satisfy <span class="math display">
\hat{\beta}_1 = \overline{a} \,, \qquad
\hat{\beta}_2 = \overline{b} - \overline{a}
</span></p></li>
<li><p>With this information, it is easy to check that they are equivalent</p>
<ul>
<li>F-statistic for Overall Significance</li>
<li>t-statistic for two-sample t-test</li>
</ul></li>
<li><p><strong>F-test of Overall Significance and two-sample t-test are equivalent</strong></p></li>
</ul>
</section>
<section id="section-45" class="slide level2 smaller">
<h2></h2>
<ul>
<li>In particular, the (fitted) dummy variable regression model is</li>
</ul>
<p><span class="math display">\begin{align*}
Y_i &amp; = \hat{\beta}_1 + \hat{\beta}_2  \, \mathbf{1}_{2} (i) + \varepsilon_i \\[10pt]
&amp; = \overline{a} + (\overline{b} - \overline{a}) \, \mathbf{1}_{2} (i) + \varepsilon_i
\end{align*}</span></p>
<ul>
<li>Therefore, the predictions are:</li>
</ul>
<p><span class="math display">\begin{align*}
{\rm I\kern-.3em E}[Y| \text{Sample is from population 1}] &amp; = \overline{a} \\[10pt]
{\rm I\kern-.3em E}[Y| \text{Sample is from population 2}] &amp; = \overline{b}
\end{align*}</span></p>
</section>
<section id="anova-f-test-and-regression-1" class="slide level2 smaller">
<h2>ANOVA F-test and Regression</h2>
<p>Now, consider the general ANOVA case</p>
<ul>
<li>Assume given <span class="math inline">k</span> independent populations with normal distribution <span class="math inline">N(\mu_i,\sigma^2)</span></li>
</ul>
<div style="font-size: 0.1em">
<p><br></p>
</div>
<ul>
<li><strong>Example:</strong> In Fridge sales example we have <span class="math inline">k = 4</span> populations (the 4 quarters)</li>
</ul>
<div style="font-size: 0.1em">
<p><br></p>
</div>
<ul>
<li>The ANOVA hypothesis for difference in populations means is</li>
</ul>
<p><span class="math display">\begin{align*}
H_0 &amp; \colon \mu_1 = \mu_2 = \ldots =  \mu_k  \\
H_1 &amp; \colon \mu_i \neq \mu_j \text{ for at least one pair i and j}
\end{align*}</span></p>
<ul>
<li><strong>Goal:</strong> Show the ANOVA F-test for above hypothesis can be obtained with regression</li>
</ul>
</section>
<section id="section-46" class="slide level2 smaller">
<h2></h2>
<ul>
<li><p>We want to introduce dummy variable regression model which models ANOVA</p></li>
<li><p>To each population, associate a dummy variable <span class="math display">
\mathbf{1}_{i}(j) = \begin{cases}
1 &amp; \text{ if j-th sample belongs to population i} \\
0 &amp; \text{ otherwise} \\
\end{cases}
</span></p></li>
<li><p>Denote by <span class="math inline">x_{i1}, \ldots, x_{in_i}</span> the iid sample of size <span class="math inline">n_{i}</span> from population <span class="math inline">i</span></p></li>
<li><p>Concatenate these samples into a long vector (length <span class="math inline">n_1 + \ldots + n_2</span>) <span class="math display">
y = (\underbrace{x_{11}, \ldots, x_{1n_1}}_{\text{population 1}}, \, \underbrace{x_{21}, \ldots, x_{2n_2}}_{\text{population 2}} , \,  \ldots, \, \underbrace{x_{k1}, \ldots, x_{kn_k}}_{\text{population k}})
</span></p></li>
<li><p>Consider the dummy variable model (with <span class="math inline">\mathbf{1}_{1}</span> omitted) <span class="math display">
Y_i = \beta_1 + \beta_2 \, \mathbf{1}_{2} (i) + \beta_3 \, \mathbf{1}_{3} (i) +  \ldots  + \beta_k \, \mathbf{1}_{k} (i) + \varepsilon_i
</span></p></li>
</ul>
</section>
<section id="section-47" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.95em">
<ul>
<li><p>In particular, the regression function is <span class="math display">
{\rm I\kern-.3em E}[Y | \mathbf{1}_{2} = x_2 , \, \ldots, \, \mathbf{1}_{k} = x_k ] = \beta_1 + \beta_2 \, x_2 +  \ldots  + \beta_k \, x_k
</span></p></li>
<li><p>By construction, we have that <span class="math display">
Y | \text{sample belongs to population i} \ \sim \ N(\mu_i , \sigma^2)
</span></p></li>
<li><p>A sample point belongs to population <span class="math inline">1</span> if and only if <span class="math display">
\mathbf{1}_{2} = \mathbf{1}_{3} = \ldots = \mathbf{1}_{k} = 0
</span></p></li>
<li><p>Hence, we can compute the conditional expectation <span class="math display">
{\rm I\kern-.3em E}[ Y | \mathbf{1}_{2} = 0 , \, \ldots, \, \mathbf{1}_{k} = 0] =
{\rm I\kern-.3em E}[Y | \text{sample belongs to population 1}] = \mu_1
</span></p></li>
<li><p>On the other hand, by definition of regression function, we get <span class="math display">
{\rm I\kern-.3em E}[ Y | \mathbf{1}_{2} = 0 , \, \ldots, \, \mathbf{1}_{k} = 0] = \beta_1 + \beta_2 \cdot 0 + \ldots + \beta_k \cdot 0 = \beta_1 \quad \implies \quad \mu_1 = \beta_1
</span></p></li>
</ul>
</div>
</section>
<section id="section-48" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.95em">
<ul>
<li><p>Similarly, a sample point belongs to population <span class="math inline">2</span> if and only if <span class="math display">
\mathbf{1}_{2} = 1 \quad \text{and} \quad \mathbf{1}_{1} = \mathbf{1}_{3} = \ldots = \mathbf{1}_{k} = 0
</span></p></li>
<li><p>Hence, we can compute the conditional expectation <span class="math display">
{\rm I\kern-.3em E}[ Y | \mathbf{1}_{2} = 1 ,  \, \mathbf{1}_{3} = 0, \, \ldots, \, \mathbf{1}_{k} = 0] =
{\rm I\kern-.3em E}[Y | \text{sample belongs to population } A_2] = \mu_2
</span></p></li>
<li><p>On the other hand, by definition of regression function, we get <span class="math display">
{\rm I\kern-.3em E}[ Y | \mathbf{1}_{2} = 1 , \, \mathbf{1}_{3} = 0, \, \ldots, \, \mathbf{1}_{k} = 0] = \beta_1 + \beta_2 \cdot 1 + \ldots + \beta_k \cdot 0 = \beta_1 + \beta_2
</span></p></li>
<li><p>Therefore, we conclude that <span class="math display">
\mu_2 = \beta_1 + \beta_2
</span></p></li>
<li><p>Arguing in a similar way, we can show that <span class="math display">
\mu_i = \beta_1 + \beta_i \,, \quad \forall \, i \geq 2
</span></p></li>
</ul>
</div>
</section>
<section id="section-49" class="slide level2 smaller">
<h2></h2>
<div style="font-size: 0.95em">
<ul>
<li><p>Therefore, we have proven <span class="math display">
\mu_1 = \beta_1 \,, \quad \mu_i = \beta_1 + \beta_i  \quad \forall \, i \geq 2 \quad \, \implies \quad \,
\beta_1 = \mu_1 \,, \quad \beta_i = \mu_i - \mu_1 \quad \forall \,  \, i \geq 2
</span></p></li>
<li><p>Recall that the regression model is <span class="math display">
Y_i = \beta_1 + \beta_2 \, \mathbf{1}_{2} (i) +   \ldots  + \beta_k \, \mathbf{1}_{k} (i) + \varepsilon_i
</span></p></li>
<li><p>The hypothesis for F-test for Overall Significance for above model is <span class="math display">
H_0 \colon  \beta_2 = \beta_3 = \ldots = \beta_k = 0 \,, \qquad
H_1 \colon \exists \, i \in \{2, \ldots, k\} \text{ s.t. } \beta_i \neq 0
</span></p></li>
<li><p>Since <span class="math inline">\beta_i = \mu_i - \mu_1</span> for all <span class="math inline">i \geq 2</span>, the above is equivalent to <span class="math display">
H_0 \colon \mu_1 = \mu_2 = \ldots = \mu_k \,  \qquad
H_1 \colon \mu_i \neq \mu_j \text{ for at least one pair } i \neq j
</span></p></li>
<li><p><strong>Hypotheses for F-test of Overall Significance and ANOVA F-test are equivalent</strong></p></li>
</ul>
</div>
</section>
<section id="section-50" class="slide level2 smaller">
<h2></h2>
<ul>
<li><p>Denote by <span class="math inline">\overline{x}_i</span> the mean of the sample <span class="math inline">x_{i1}, \ldots, x_{i n_i}</span> from population i</p></li>
<li><p>It is easy to prove that the ML estimators for the model <span class="math display">
Y_i = \beta_1 + \beta_2  \, \mathbf{1}_{2} (i) + \ldots + \beta_k  \, \mathbf{1}_{k} (i) + \varepsilon_i
</span> satisfy <span class="math display">
\hat{\beta}_1 = \overline{x}_1 \,, \qquad
\hat{\beta}_i = \overline{x}_i - \overline{x}_1 \, \quad \forall  \, i \geq 2
</span></p></li>
<li><p>With this information, it is easy to check that they are equivalent</p>
<ul>
<li>F-statistic for Overall Significance</li>
<li>F-statistic for ANOVA F-test</li>
</ul></li>
<li><p><strong>F-test of Overall Significance and ANOVA F-test are equivalent</strong></p></li>
</ul>
</section>
<section id="section-51" class="slide level2 smaller">
<h2></h2>
<ul>
<li>In particular, the (fitted) dummy variable regression model is</li>
</ul>
<p><span class="math display">\begin{align*}
Y_i &amp; = \hat{\beta}_1 + \hat{\beta}_2  \, \mathbf{1}_{2} (i) + \hat{\beta}_k  \, \mathbf{1}_{k} (i) + \varepsilon_i \\[10pt]
&amp; = \overline{x}_1 + (\overline{x}_2 - \overline{x}_1) \, \mathbf{1}_{2} (i) + \ldots +  (\overline{x}_k - \overline{x}_1)  \, \mathbf{1}_{k} (i) + \varepsilon_i
\end{align*}</span></p>
<ul>
<li>Therefore, the predictions are:</li>
</ul>
<p><span class="math display">
{\rm I\kern-.3em E}[Y| \text{Sample is from population i}] = \hat{\beta}_1 + \hat{\beta}_i = \overline{x}_i
</span></p>
</section>
<section id="worked-example" class="slide level2 smaller">
<h2>Worked Example</h2>
<ul>
<li><p>The data in <a href="datasets/fridge_sales.txt">fridge_sales.txt</a> links</p>
<ul>
<li><em>Sales of fridges</em> and <em>Sales of durable goods</em></li>
<li>to the time of year (<em>Quarter</em>)</li>
</ul></li>
<li><p>For the moment, ignore the data on the <em>Sales of durable goods</em></p></li>
<li><p><strong>Goal:</strong> Determine if <em>Fridge sales</em> are linked to the <em>time of the year</em></p></li>
<li><p>There are two ways this can be achieved in R</p>
<ol type="1">
<li>ANOVA F-test for equality of means  using the command <span class="math inline">\, \texttt{aov}</span></li>
<li>Dummy variable regression approach  using the command <span class="math inline">\, \texttt{lm}</span></li>
</ol></li>
</ul>
<p><br></p>
<ul>
<li>Code for this example is available here <a href="codes/anova.R">anova.R</a></li>
</ul>
</section>
<section id="section-52" class="slide level2 smaller">
<h2></h2>
<ul>
<li>Data is in the file <a href="datasets/fridge_sales.txt">fridge_sales.txt</a>
<ul>
<li>We read the data into a data-frame as usual</li>
<li>The first 4 rows of the data-set are given below</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset on Fridge Sales</span></span>
<span id="cb108-2"><a aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file =</span> <span class="st">"fridge_sales.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb108-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print first 4 rows</span></span>
<span id="cb108-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d, <span class="at">n=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  fridge.sales durable.goods.sales q1 q2 q3 q4 quarter
1         1317               252.6  1  0  0  0       1
2         1615               272.4  0  1  0  0       2
3         1662               270.9  0  0  1  0       3
4         1295               273.9  0  0  0  1       4</code></pre>
</div>
</div>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<div class="column" style="width:58%;">
<ul>
<li>Quantitative variables
<ul>
<li><em>Fridge sales</em></li>
<li><em>Durable goods sales</em> <span class="math inline">\,</span> (ignore for now)</li>
</ul></li>
</ul>
</div><div class="column" style="width:38%;">
<ul>
<li>Qualitative variables
<ul>
<li><em>q1, q2, q3, q4</em></li>
<li><em>quarter</em></li>
</ul></li>
</ul>
</div></section>
<section id="preparing-the-data-1" class="slide level2 smaller">
<h2>Preparing the data</h2>
<ul>
<li>The variables <code>d$q1</code>, <code>d$q2</code>, <code>d$q3</code>, <code>d$q4</code> are vectors taking the values <span class="math inline">\, \texttt{0}</span> and <span class="math inline">\, \texttt{1}</span>
<ul>
<li>No further data processing is needed</li>
<li><strong>Remember:</strong> To avoid dummy variable trap, only 3 of these 4 dummy variables can be included (if the model also includes an intercept term)</li>
</ul></li>
</ul>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li>The variable <code>d$quarter</code> is a vector taking the values <span class="math inline">\, \texttt{1}, \texttt{2}, \texttt{3}, \texttt{4}</span>
<ul>
<li>Need to convert this into a factor</li>
</ul></li>
</ul>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>quarter <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>quarter)</span>
<span id="cb110-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(d<span class="sc">$</span>quarter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
</div>
</section>
<section id="section-53" class="slide level2 smaller">
<h2></h2>
<div class="sourceCode" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Make boxplot of Fridge Sales vs Quarter</span></span>
<span id="cb112-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(fridge.sales <span class="sc">~</span> quarter, <span class="at">data =</span> d,</span>
<span id="cb112-3"><a aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Quarterly Fridge sales"</span>, <span class="at">ylab =</span> <span class="st">"Fridge sales"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="lecture_11_files/figure-revealjs/unnamed-chunk-45-1.png" width="960" class="r-stretch"><ul>
<li><p>Fridge sales seem higher in Q2 and Q3</p></li>
<li><p>We suspect population means are different: need one-way ANOVA F-test</p></li>
</ul>
</section>
<section id="anova-and-regression" class="slide level2 smaller">
<h2>ANOVA and Regression</h2>
<p>As already mentioned, there are 2 ways of performing ANOVA F-test</p>
<ol type="1">
<li>ANOVA F-test for equality of means  using the command <span class="math inline">\, \texttt{aov}</span></li>
<li>Dummy variable regression approach  using the command <span class="math inline">\, \texttt{lm}</span></li>
</ol>
<div style="font-size: 0.20em">
<p><br></p>
</div>
<ul>
<li>As already discussed in the previous Part,
<ul>
<li><strong>Both approaches lead to the same numerical answer</strong></li>
</ul></li>
</ul>
</section>
<section id="anova-f-test-with-aov" class="slide level2 smaller">
<h2>1. ANOVA F-test with aov</h2>
<ul>
<li>We have <em>Fridge Sales</em> data for each quarter
<ul>
<li>Each <em>Quarter</em> represents a population</li>
<li>Let <span class="math inline">\mu_i</span> denote the average (population) fridge sales in quarter i</li>
</ul></li>
<li>Hypothesis for comparing quarterly fridge sales are</li>
</ul>
<p><span class="math display">\begin{align*}
H_0 &amp; \colon \mu_{1} =  \mu_{2} = \mu_3 = \mu_4   \\
H_1 &amp; \colon  \mu_i \neq \mu_j \, \text{ for at least one pair } i \neq j
\end{align*}</span></p>
<ul>
<li><p>To decide on the above hypothesis, we use the <strong>ANOVA F-test</strong></p></li>
<li><p>Already seen an example of this with the <em>calories consumption</em> dataset</p></li>
</ul>
</section>
<section id="section-54" class="slide level2 smaller">
<h2></h2>
<div class="sourceCode" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Perform ANOVA F-test - Recall: quarter needs to be a factor</span></span>
<span id="cb113-2"><a aria-hidden="true" tabindex="-1"></a>anova <span class="ot">&lt;-</span> <span class="fu">aov</span>(fridge.sales <span class="sc">~</span> quarter, <span class="at">data =</span> d)</span>
<span id="cb113-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print output</span></span>
<span id="cb113-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
quarter      3 915636  305212    10.6 7.91e-05 ***
Residuals   28 806142   28791                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<ul>
<li><p>The F-statistic for the ANOVA F-test is <span class="math inline">\,\, F = 10.6</span></p></li>
<li><p>The p-value for ANOVA F-test is <span class="math inline">\,\, p = 7.91 \times 10^{-5}</span></p></li>
<li><p>Therefore <span class="math inline">p &lt; 0.05</span>, and we reject <span class="math inline">H_0</span></p>
<ul>
<li>Evidence that average Fridge sales are different in at least two quarters</li>
</ul></li>
</ul>
</section>
<section id="dummy-variable-regression-approach" class="slide level2 smaller">
<h2>2. Dummy variable Regression approach</h2>
<ul>
<li>Encode each Quarter with one dummy variable <span class="math inline">\mathbf{1}_i</span></li>
</ul>
<p><span class="math display">
\mathbf{1}_i(j) = \begin{cases}
1 &amp; \text{ if sample j belongs to Quarter i} \\
0 &amp; \text{ otherwise} \\
\end{cases}
</span></p>
<ul>
<li><p>Let <span class="math inline">Y</span> denote the <em>Fridge sales</em> data</p></li>
<li><p>Consider the dummy variable regression model</p></li>
</ul>
<p><span class="math display">
Y =  \beta_1  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4   + \varepsilon
</span></p>
<ul>
<li>Note: We have dropped the variable <span class="math inline">\mathbf{1}_1</span> to avoid dummy variable trap</li>
</ul>
</section>
<section id="section-55" class="slide level2 smaller">
<h2></h2>
<p>We can fit the following model in 2 equivalent ways</p>
<p><span class="math display">\begin{equation} \tag{1}
Y =  \beta_1  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4   + \varepsilon
\end{equation}</span></p>
<ol type="1">
<li>Use quarter dummy variables <span class="math inline">\, \texttt{q2}</span>, <span class="math inline">\, \texttt{q3}</span>, <span class="math inline">\, \texttt{q4}</span> already present in the dataset</li>
</ol>
<div class="sourceCode" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># We drop q1 to avoid dummy variable trap</span></span>
<span id="cb115-2"><a aria-hidden="true" tabindex="-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">lm</span> (fridge.sales <span class="sc">~</span> q2 <span class="sc">+</span> q3 <span class="sc">+</span> q4, <span class="at">data =</span> d)</span>
<span id="cb115-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dummy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.15em">
<p><br></p>
</div>
<ol start="2" type="1">
<li>Use quarters stored in the factor <span class="math inline">\, \texttt{quarter}</span>
<ul>
<li><code>lm</code> automatically encodes <span class="math inline">\, \texttt{quarter}</span> into 3 dummy variables <span class="math inline">\, \texttt{q2}</span>, <span class="math inline">\, \texttt{q3}</span>, <span class="math inline">\, \texttt{q4}</span></li>
</ul></li>
</ol>
<div class="sourceCode" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a aria-hidden="true" tabindex="-1"></a>dummy.equivalent <span class="ot">&lt;-</span> <span class="fu">lm</span>(fridge.sales <span class="sc">~</span> quarter, <span class="at">data =</span> d)</span>
<span id="cb116-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dummy.equivalent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li>Both commands fit the same linear model (1)</li>
</ul>
</section>
<section id="output-for-first-command" class="slide level2 smaller">
<h2>Output for first command</h2>
<div style="font-size: 0.83em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ q2 + q3 + q4, data = d)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1222.12      59.99  20.372  &lt; 2e-16 ***
q2            245.37      84.84   2.892 0.007320 ** 
q3            347.63      84.84   4.097 0.000323 ***
q4            -62.12      84.84  -0.732 0.470091    
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 169.7 on 28 degrees of freedom
Multiple R-squared:  0.5318,    Adjusted R-squared:  0.4816 
F-statistic:  10.6 on 3 and 28 DF,  p-value: 7.908e-05</code></pre>
</div>
<div style="font-size: 0.1em">
<p><br></p>
</div>
</section>
<section id="output-for-second-command" class="slide level2 smaller">
<h2>Output for second command</h2>
<div style="font-size: 0.83em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ quarter, data = d)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1222.12      59.99  20.372  &lt; 2e-16 ***
quarter2      245.37      84.84   2.892 0.007320 ** 
quarter3      347.63      84.84   4.097 0.000323 ***
quarter4      -62.12      84.84  -0.732 0.470091    
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 169.7 on 28 degrees of freedom
Multiple R-squared:  0.5318,    Adjusted R-squared:  0.4816 
F-statistic:  10.6 on 3 and 28 DF,  p-value: 7.908e-05</code></pre>
</div>
<div style="font-size: 0.1em">
<p><br></p>
</div>
<ul>
<li><p>The two outputs are the same (only difference is variables names)</p></li>
<li><p><span class="math inline">\, \texttt{quarter}</span> is a factor with four levels <span class="math inline">\, \texttt{1}, \texttt{2}, \texttt{3}, \texttt{4}</span></p></li>
<li><p>Variables <span class="math inline">\, \texttt{quarter2}, \texttt{quarter3}, \texttt{quarter4}</span> refer to the levels <span class="math inline">\, \texttt{2}, \texttt{3}, \texttt{4}</span></p></li>
</ul>
</section>
<section id="output-for-second-command-1" class="slide level2 smaller">
<h2>Output for second command</h2>
<div style="font-size: 0.83em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ quarter, data = d)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1222.12      59.99  20.372  &lt; 2e-16 ***
quarter2      245.37      84.84   2.892 0.007320 ** 
quarter3      347.63      84.84   4.097 0.000323 ***
quarter4      -62.12      84.84  -0.732 0.470091    
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1

Residual standard error: 169.7 on 28 degrees of freedom
Multiple R-squared:  0.5318,    Adjusted R-squared:  0.4816 
F-statistic:  10.6 on 3 and 28 DF,  p-value: 7.908e-05</code></pre>
</div>
<div style="font-size: 0.1em">
<p><br></p>
</div>
<ul>
<li><p><span class="math inline">\, \texttt{lm}</span> interprets <span class="math inline">\, \texttt{quarter2}, \texttt{quarter3}, \texttt{quarter4}</span> as dummy variables</p></li>
<li><p>Note that <span class="math inline">\, \texttt{lm}</span> automatically drops <span class="math inline">\, \texttt{quarter1}</span> to prevent dummy variable trap</p></li>
<li><p>Thus: <span class="math inline">\, \texttt{lm}</span> behaves the same way as if we passed dummy variables <span class="math inline">\, \texttt{q2}, \texttt{q3}, \texttt{q4}</span></p></li>
</ul>
</section>
<section id="computing-regression-coefficients" class="slide level2 smaller">
<h2>Computing regression coefficients</h2>
<div style="font-size: 0.90em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ q2 + q3 + q4, data = d)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1222.12      59.99  20.372  &lt; 2e-16 ***
q2            245.37      84.84   2.892 0.007320 ** 
q3            347.63      84.84   4.097 0.000323 ***
q4            -62.12      84.84  -0.732 0.470091     </code></pre>
</div>
<div style="font-size: 0.3em">
<p><br></p>
</div>
<ul>
<li><p>Recall that <span class="math inline">\, \texttt{Intercept}</span> refers to coefficient for <span class="math inline">\, \texttt{q1}</span></p></li>
<li><p>Coefficients for <span class="math inline">\, \texttt{q2}, \texttt{q3}, \texttt{q4}</span> are obtained by summing <span class="math inline">\, \texttt{Intercept}</span> to coefficient in appropriate row</p></li>
</ul>
</section>
<section id="computing-regression-coefficients-1" class="slide level2 smaller">
<h2>Computing regression coefficients</h2>
<div style="font-size: 0.90em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ q2 + q3 + q4, data = d)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1222.12      59.99  20.372  &lt; 2e-16 ***
q2            245.37      84.84   2.892 0.007320 ** 
q3            347.63      84.84   4.097 0.000323 ***
q4            -62.12      84.84  -0.732 0.470091    </code></pre>
</div>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<div style="font-size: 0.9em">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: right;">Dummy variable</th>
<th style="text-align: right;">Coefficient formula</th>
<th style="text-align: right;">Estimated coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\texttt{q1}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1</span></td>
<td style="text-align: right;"><span class="math inline">1222.12</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\texttt{q2}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1 + \beta_2</span></td>
<td style="text-align: right;"><span class="math inline">1222.12 + 245.37 = 1467.49</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\texttt{q3}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1 + \beta_3</span></td>
<td style="text-align: right;"><span class="math inline">1222.12 + 347.63 = 1569.75</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\texttt{q4}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1 + \beta_4</span></td>
<td style="text-align: right;"><span class="math inline">1222.12 - 62.12 = 1160</span></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="regression-formula" class="slide level2 smaller">
<h2>Regression formula</h2>
<ul>
<li>Therefore, the linear regression formula obtained is</li>
</ul>
<p><span class="math display">\begin{align*}
{\rm I\kern-.3em E}[\text{ Fridge sales } ] = &amp; \,\, 1222.12 \times \, \text{Q1} +
1467.49 \times \, \text{Q2} + \\[15pts]
&amp; \,\, 1569.75 \times \, \text{Q3} + 1160 \times \, \text{Q4}
\end{align*}</span></p>
<ul>
<li>Recall that Q1, Q2, Q3 and Q4 assume only values 0 / 1 and</li>
</ul>
<p><span class="math display">
\text{Q1} + \text{Q2} + \text{Q4} + \text{Q4} = 1
</span></p>
</section>
<section id="sales-estimates" class="slide level2 smaller">
<h2>Sales estimates</h2>
<ul>
<li>Therefore, the expected sales for each quarter are</li>
</ul>
<p><span class="math display">\begin{align*}
{\rm I\kern-.3em E}[\text{ Fridge sales } | \text{ Q1} = 1] &amp; = 1222.12  \,, \qquad
{\rm I\kern-.3em E}[\text{ Fridge sales } | \text{ Q2} = 1]  = 1467.49 \\[15pts]
{\rm I\kern-.3em E}[\text{ Fridge sales } | \text{ Q3} = 1] &amp; = 1569.75 \,, \qquad
{\rm I\kern-.3em E}[\text{ Fridge sales } | \text{ Q4} = 1]  = 1160
\end{align*}</span></p>
<ul>
<li>These estimates coincide with sample means in each quarter<br>
(As already noted, this is true for any dummy variable regression model)</li>
</ul>
<div class="sourceCode" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># For example, compute average fridge sales in Q3</span></span>
<span id="cb122-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a aria-hidden="true" tabindex="-1"></a>fridge.sales.q3 <span class="ot">&lt;-</span> d<span class="sc">$</span>fridge.sales[ d<span class="sc">$</span>quarter <span class="sc">==</span> <span class="dv">3</span> ]</span>
<span id="cb122-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fridge.sales.q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1569.75</code></pre>
</div>
</div>
</section>
<section id="anova-f-test-from-regression" class="slide level2 smaller">
<h2>ANOVA F-test from regression</h2>
<ul>
<li><p>ANOVA F-test is equivalend to F-test for Overall Significance of model <span class="math display">
Y =  \beta_1  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4   + \varepsilon
</span></p></li>
<li><p>Therefore, look at F-test line in the summary of model <span class="math display">
\texttt{lm(fridge} \, \sim \, \texttt{q2 + q3 + q4)}
</span></p></li>
</ul>
<pre class="verbatim"><code>F-statistic:  10.6 on 3 and 28 DF,  p-value: 7.908e-05</code></pre>
<div style="font-size: 0.15em">
<p><br></p>
</div>
<ul>
<li><p>F-statistic is <span class="math inline">\,\, F = 10.6 \, , \quad</span> p-value is <span class="math inline">\,\, p = 7.908 \times 10^{-5}</span></p></li>
<li><p><strong>These coincide with F-statistic and p-value for ANOVA F-test</strong></p></li>
<li><p>Therefore <span class="math inline">p &lt; 0.05</span>, and we reject <span class="math inline">H_0</span></p>
<ul>
<li>Evidence that average Fridge sales are different in at least two quarters</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="part-9-ancova" class="title-slide slide level1 center" data-background-color="#cc0164" data-visibility="uncounted">
<h1>Part 9: <br> ANCOVA</h1>
<div class="footer">
<div color="#cc0164">

</div>
</div>
</section>
<section id="ancova" class="slide level2 smaller">
<h2>ANCOVA</h2>
<p>Linear regression models seen so far:</p>
<ul>
<li>Regular regression: All <span class="math inline">X</span> variables are quantitative</li>
<li>ANOVA: Dummy variable models, where all <span class="math inline">X</span> variables are qualitative</li>
</ul>
<p>ANCOVA:</p>
<ul>
<li>means <em>Analysis of Covariance</em></li>
<li>Refers to regression models containing both:
<ul>
<li>Qualitative dummy variables <strong>and</strong></li>
<li>quantitative variables</li>
</ul></li>
</ul>
</section>
<section id="ancova-main-feature" class="slide level2 smaller">
<h2>ANCOVA main feature</h2>
<ul>
<li><p>Regression models with different slopes / intercept for different parts of the dataset</p></li>
<li><p>These are sometimes referred to as <em>segmented regression models</em></p></li>
<li><p>For example, consider the ANCOVA regression model</p></li>
</ul>
<p><span class="math display">
Y=\beta_1+\beta_2 X + \beta_3 Q + \beta_4 XQ  + \varepsilon
</span></p>
<ul>
<li><p><span class="math inline">X</span> is quantitative variable; <span class="math inline">Q</span> is qualitative, with values <span class="math inline">Q = 0, 1</span></p></li>
<li><p><span class="math inline">XQ</span> is called <strong>interaction term</strong></p></li>
</ul>
</section></section>
<section>
<section id="section-56" class="title-slide slide level1 smaller center">
<h1></h1>
<p>With reference to the ANCOVA model <span class="math display">
Y=\beta_1+\beta_2 X + \beta_3 Q + \beta_4 XQ  + \varepsilon
</span></p>
<ul>
<li><p>If <span class="math inline">Q=0</span> <span class="math display">
Y=\beta_1+\beta_2 X+ \varepsilon
</span></p></li>
<li><p>If <span class="math inline">Q=1</span>, the result is a model with different intercept and slope <span class="math display">
Y=(\beta_1+\beta_3)+(\beta_2 +\beta_4)X+ \varepsilon
</span></p></li>
<li><p>If <span class="math inline">Q=1</span> and <span class="math inline">\beta_4=0</span>, we get model with a different intercept but the same slope <span class="math display">
Y=(\beta_1+\beta_3)+\beta_2 X+ \varepsilon
</span></p></li>
<li><p>ANCOVA models are simply fitted with <code>lm</code></p></li>
</ul>
</section>
<section id="worked-example-1" class="slide level2 smaller">
<h2>Worked Example</h2>
<ul>
<li><p>Code for this example is available here <a href="codes/ancova.R">ancova.R</a></p></li>
<li><p>The data in <a href="datasets/fridge_sales.txt">fridge_sales.txt</a> links</p>
<ul>
<li><em>Sales of fridges</em> and <em>Sales of durable goods</em></li>
<li>to the time of year (<em>Quarter</em>)</li>
</ul></li>
<li><p><strong>Goal:</strong> Predict <em>Fridge sales</em> in terms of <em>durable goods sales</em> and <em>time of the year</em></p></li>
<li><p>Denote by <span class="math inline">F</span> the <em>Fridge sales</em> and by <span class="math inline">D</span> the <em>durable goods sales</em></p></li>
<li><p>To predict Fridge sales from <em>durable goods sales</em>, we could simply fit the model</p></li>
</ul>
<p><span class="math display">
F = \beta_1 + \beta_2 D + \varepsilon
</span></p>
<ul>
<li><p>However, the intercept <span class="math inline">\beta_1</span> can potentially change depending on the quarter</p></li>
<li><p>To account for quarterly trends, we fit ANCOVA model instead</p></li>
</ul>
</section>
<section id="preparing-the-data-2" class="slide level2 smaller">
<h2>Preparing the data</h2>
<div style="font-size: 0.94em">
<ul>
<li>Read the data <a href="datasets/fridge_sales.txt">fridge_sales.txt</a> into a data-frame</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset on Fridge Sales</span></span>
<span id="cb125-2"><a aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file =</span> <span class="st">"fridge_sales.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb125-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Print first 4 rows</span></span>
<span id="cb125-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d, <span class="at">n=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  fridge.sales durable.goods.sales q1 q2 q3 q4 quarter
1         1317               252.6  1  0  0  0       1
2         1615               272.4  0  1  0  0       2
3         1662               270.9  0  0  1  0       3
4         1295               273.9  0  0  0  1       4</code></pre>
</div>
</div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li><p>Variables <code>d$q1</code>, <code>d$q2</code>, <code>d$q3</code>, <code>d$q4</code> are vectors taking the values <span class="math inline">\, \texttt{0}</span> and <span class="math inline">\, \texttt{1}</span></p></li>
<li><p>The variable <code>d$quarter</code> is a vector taking the values <span class="math inline">\, \texttt{1}, \texttt{2}, \texttt{3}, \texttt{4}</span></p>
<ul>
<li>Need to convert this into a factor</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>quarter <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>quarter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ancova-model" class="slide level2 smaller">
<h2>ANCOVA Model</h2>
<ul>
<li>As before, we encode each Quarter with one dummy variable <span class="math inline">\mathbf{1}_i</span></li>
</ul>
<p><span class="math display">
\mathbf{1}_i(j) = \begin{cases}
1 &amp; \text{ if sample j belongs to Quarter i} \\
0 &amp; \text{ otherwise} \\
\end{cases}
</span></p>
<ul>
<li>The ANCOVA model is</li>
</ul>
<p><span class="math display">
F =  \beta_1  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4 + \beta_5 D  + \varepsilon
</span></p>
<ul>
<li><p>Note: We have dropped the variable <span class="math inline">\mathbf{1}_1</span> to avoid dummy variable trap</p></li>
<li><p>This way, the intercept will vary depending on the quarter</p></li>
</ul>
</section>
<section id="section-57" class="slide level2 smaller">
<h2></h2>
<p>We can fit the ANCOVA model below in 2 equivalent ways</p>
<p><span class="math display">\begin{equation} \tag{2}
F =  \beta_1  + \beta_2 \mathbf{1}_2 + \beta_3 \mathbf{1}_3 + \beta_4 \mathbf{1}_4 + \beta_5 D  + \varepsilon
\end{equation}</span></p>
<ol type="1">
<li>Use quarter dummy variables <span class="math inline">\, \texttt{q2}</span>, <span class="math inline">\, \texttt{q3}</span>, <span class="math inline">\, \texttt{q4}</span> already present in the dataset</li>
</ol>
<div class="sourceCode" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Drop q1 to avoid dummy variable trap</span></span>
<span id="cb128-2"><a aria-hidden="true" tabindex="-1"></a>ancova <span class="ot">&lt;-</span> <span class="fu">lm</span>(fridge.sales <span class="sc">~</span> q2 <span class="sc">+</span> q3 <span class="sc">+</span> q4 <span class="sc">+</span> durable.goods.sales, <span class="at">data =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.15em">
<p><br></p>
</div>
<ol start="2" type="1">
<li>Use quarters stored in the factor <span class="math inline">\, \texttt{quarter}</span>
<ul>
<li><code>lm</code> automatically encodes <span class="math inline">\, \texttt{quarter}</span> into 3 dummy variables <span class="math inline">\, \texttt{q2}</span>, <span class="math inline">\, \texttt{q3}</span>, <span class="math inline">\, \texttt{q4}</span></li>
</ul></li>
</ol>
<div class="sourceCode" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb129-2"><a aria-hidden="true" tabindex="-1"></a>ancova.equiv <span class="ot">&lt;-</span> <span class="fu">lm</span>(fridge.sales <span class="sc">~</span> quarter <span class="sc">+</span> durable.goods.sales, <span class="at">data =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li>Both commands fit the same linear model (2)</li>
</ul>
</section>
<section id="output" class="slide level2 smaller">
<h2>Output</h2>

<img data-src="images/ancova.png" style="width:80.0%" class="r-stretch"></section>
<section id="computing-regression-coefficients-2" class="slide level2 smaller">
<h2>Computing regression coefficients</h2>
<div style="font-size: 0.90em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ q2 + q3 + q4 + durable.goods.sales, 
    data = d)
Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         456.2440   178.2652   2.559 0.016404 *  
q2                  242.4976    65.6259   3.695 0.000986 ***
q3                  325.2643    65.8148   4.942 3.56e-05 ***
q4                  -86.0804    65.8432  -1.307 0.202116    
durable.goods.sales   2.7734     0.6233   4.450 0.000134 ***    </code></pre>
</div>
<div style="font-size: 0.3em">
<p><br></p>
</div>
<ul>
<li><p>Recall that <span class="math inline">\, \texttt{Intercept}</span> refers to coefficient for <span class="math inline">\, \texttt{q1}</span></p></li>
<li><p>Coefficients for <span class="math inline">\, \texttt{q2}, \texttt{q3}, \texttt{q4}</span> are obtained by summing <span class="math inline">\, \texttt{Intercept}</span> to coefficient in appropriate row</p></li>
</ul>
</section>
<section id="computing-regression-coefficients-3" class="slide level2 smaller">
<h2>Computing regression coefficients</h2>
<div style="font-size: 0.90em">
<pre class="verbatim"><code>Call:
lm(formula = fridge.sales ~ q2 + q3 + q4 + durable.goods.sales, 
    data = d)
Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         456.2440   178.2652   2.559 0.016404 *  
q2                  242.4976    65.6259   3.695 0.000986 ***
q3                  325.2643    65.8148   4.942 3.56e-05 ***
q4                  -86.0804    65.8432  -1.307 0.202116    
durable.goods.sales   2.7734     0.6233   4.450 0.000134 ***    </code></pre>
</div>
<div style="font-size: 0.5em">
<p><br></p>
</div>
<div style="font-size: 0.9em">
<table class="caption-top">
<colgroup>
<col style="width: 23%">
<col style="width: 32%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th style="text-align: right;">Coefficient formula</th>
<th style="text-align: right;">Estimated coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\texttt{q1}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1</span></td>
<td style="text-align: right;"><span class="math inline">\approx 456.24</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\texttt{q2}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1 + \beta_2</span></td>
<td style="text-align: right;"><span class="math inline">456.244 + 242.4976 \approx 698.74</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\texttt{q3}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1 + \beta_3</span></td>
<td style="text-align: right;"><span class="math inline">456.244 + 325.2643 \approx 781.51</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\texttt{q4}</span></td>
<td style="text-align: right;"><span class="math inline">\beta_1 + \beta_4</span></td>
<td style="text-align: right;"><span class="math inline">456.244 - 86.0804 \approx 370.16</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">D</span></td>
<td style="text-align: right;"><span class="math inline">\beta_5</span></td>
<td style="text-align: right;"><span class="math inline">\approx 2.77</span></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="regression-formula-and-lines" class="slide level2 smaller">
<h2>Regression formula and lines</h2>
<div style="font-size: 0.95em">
<ul>
<li>Therefore, the linear regression formula obtained is</li>
</ul>
<p><span class="math display">\begin{align*}
{\rm I\kern-.3em E}[\text{ Fridge sales } ] = &amp; \,\, 456.24  \times \, \text{Q1} +
698.74 \times \, \text{Q2} + \\[5pts]
&amp; \,\, 781.51 \times \, \text{Q3} + 370.16 \times \, \text{Q4} + 2.77 \times \text{D}
\end{align*}</span></p>
<ul>
<li>Therefore, we obtain the following regression lines</li>
</ul>
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">Quarter</th>
<th style="text-align: left;">Regression line</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Q1</td>
<td style="text-align: left;"><span class="math inline">F = 456.24 + 2.77 \times \text{D}</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Q2</td>
<td style="text-align: left;"><span class="math inline">F = 698.74 + 2.77 \times \text{D}</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q3</td>
<td style="text-align: left;"><span class="math inline">F = 781.51 + 2.77 \times \text{D}</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Q4</td>
<td style="text-align: left;"><span class="math inline">F = 370.16 + 2.77 \times \text{D}</span></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Each quarter has a different intercept: Different baseline fridge sales</strong></li>
</ul>
</div>
</section>
<section id="conclusion" class="slide level2 smaller">
<h2>Conclusion</h2>
<ul>
<li>We compare the ANCOVA model to the simple linear model</li>
</ul>
<div class="sourceCode" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simple linear model</span></span>
<span id="cb132-2"><a aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(fridge.sales <span class="sc">~</span> durable.goods.sales, <span class="at">data =</span> d)</span>
<span id="cb132-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># F-test for Model Selection</span></span>
<span id="cb132-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(linear, ancova)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<pre class="verbatim"><code>Analysis of Variance Table

Model 1: fridge.sales ~ durable.goods.sales
Model 2: fridge.sales ~ quarter + durable.goods.sales
  Res.Df     RSS Df Sum of Sq     F    Pr(&gt;F)    
1     30 1377145                                 
2     27  465085  3    912060 17.65 1.523e-06 ***</code></pre>
<div style="font-size: 0.10em">
<p><br></p>
</div>
<ul>
<li><p>The p-value is <span class="math inline">p &lt; 0.05 \quad \implies \quad</span> Reject <span class="math inline">H_0</span></p></li>
<li><p>The ANCOVA model offers a better fit than the linear model</p></li>
</ul>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">
<p><a href="../index.html">Homepage</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../license.html">License</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="https://www.silviofanzon.com/contact">Contact</a></p>
</div>
</div>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-gujarati_porter" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">Gujarati, D. N., Porter, D. C., Basic econometric, fifth edition, McGraw-Hill, 2009.</div>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>